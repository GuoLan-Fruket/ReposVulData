{"index": 9285, "cve_id": "CVE-2022-3389", "cwe_id": ["CWE-22"], "cve_language": "Python", "cve_description": "Path Traversal in GitHub repository ikus060/rdiffweb prior to 2.4.10.", "cvss": "7.5", "publish_date": "October 6, 2022", "AV": "NETWORK", "AC": "NETWORK", "PR": "NONE", "UI": "NONE", "S": "UNCHANGED", "C": "HIGH", "I": "NONE", "A": "NONE", "commit_id": "323383d1db656f1b1291be529947bd943a6b0e99", "commit_message": "Mitigate path traversal vulnerability #227", "commit_date": "2022-10-03T11:58:08Z", "project": "ikus060/rdiffweb", "url": "https://api.github.com/repos/ikus060/rdiffweb/commits/323383d1db656f1b1291be529947bd943a6b0e99", "html_url": "https://github.com/ikus060/rdiffweb/commit/323383d1db656f1b1291be529947bd943a6b0e99", "windows_before": [{"commit_id": "7bdb1d6cf844dd9397ccb5b55fbc1216de8ec2f3", "commit_date": "Fri Sep 30 19:52:31 2022 +0000", "commit_message": "Merge branch 'patrik-stable-test-packages' into 'master'", "files_name": ["44bed43eb3e2230eaed04cfd4a9e047cd23f88f7 - Fri Sep 30 12:55:05 2022 -0400 : Make test-package more robust in CICD", ".gitlab-ci.yml"]}, {"commit_id": "9d18c38957434eb417b49022cbd5db9814897694", "commit_date": "Fri Sep 30 16:25:53 2022 +0000", "commit_message": "Merge branch 'patrik-rate-limit-password-change' into 'master'", "files_name": ["b5e3bb0a98268d18ceead36ab9b2b7eaacd659a8 - Fri Sep 30 11:47:01 2022 -0400 : Limit incorrect attempts to change the user's password to prevent brute force attacks #225", "README.md", "rdiffweb/controller/__init__.py", "rdiffweb/controller/page_admin_users.py", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/tests/test_page_prefs_general.py", "rdiffweb/core/login.py", "rdiffweb/core/model/_user.py", "rdiffweb/core/model/tests/test_user.py"]}, {"commit_id": "a92b4fa441d50aee48ad257a0cad1e2aac77cb26", "commit_date": "Fri Sep 30 13:53:45 2022 +0000", "commit_message": "Merge branch 'patrik-validate-fullname' into 'master'", "files_name": ["4d464b467f14b8eb9103d7f5f0774e49995527c7 - Fri Sep 30 13:53:45 2022 +0000 : Enforce validation on fullname, username and email for increase security #224", "README.md", "rdiffweb/controller/page_admin_users.py", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/tests/test_page_admin_users.py", "rdiffweb/controller/tests/test_page_prefs_general.py", "rdiffweb/core/model/_user.py"]}, {"commit_id": "fc5bfa3be5fdd8951e3ecdd71ee0e39f837842d0", "commit_date": "Thu Sep 29 14:47:18 2022 +0000", "commit_message": "Merge branch 'patrik-rdiff-backup-beta' into 'master'", "files_name": ["1269126ee29f2bd25cab3f8e221997fe3cb13b40 - Wed Sep 7 12:32:44 2022 -0400 : Test with beta version of rdiff-backup", ".gitlab-ci.yml", "rdiffweb/core/librdiff.py", "rdiffweb/core/restore.py", "rdiffweb/core/tests/test_restore.py"]}, {"commit_id": "34f7007ea0c10213d339097504a97acbfa338b2a", "commit_date": "Thu Sep 29 12:58:02 2022 +0000", "commit_message": "Merge branch 'patrik-fix-permissions' into 'master'", "files_name": ["ac30bdbdd6f22859d9fe89370d1d58df43c8ebf4 - Thu Sep 29 12:18:57 2022 +0000 : Merge branch 'patrik-remove-older-session' into 'master'", "9aa7191c8b355df95682df23f645f7d573a52c50 - Thu Sep 29 07:56:48 2022 -0400 : Enforce permissions on /etc/rdiffweb", "README.md", "debian/rdiffweb.postinst"]}, {"commit_id": "b2b1f18472cd0855d6a2dd4123a3bac08a8727a3", "commit_date": "Sun Sep 25 17:44:53 2022 -0400", "commit_message": "Timeout 15 min by default and 30 days for persistent session", "files_name": ["rdiffweb/controller/tests/test_page_mfa.py", "rdiffweb/core/config.py", "rdiffweb/core/model/_session.py", "rdiffweb/rdw_app.py", "rdiffweb/tools/auth_form.py", "rdiffweb/tools/auth_mfa.py"]}, {"commit_id": "ba300f7de87ed78f7ca757ecb62622a0044e5034", "commit_date": "Wed Sep 28 21:50:35 2022 +0000", "commit_message": "Merge branch 'patrik-csrf-notification' into 'master'", "files_name": ["a98e965d5651eb9d2fadd3eebee3dbcf0a2989cc - Wed Sep 28 10:29:07 2022 -0400 : Configure proxy tools with `X-Real-IP`", "rdiffweb/rdw_app.py", "rdiffweb/tools/real_ip.py"]}, {"commit_id": "cdd73cd05629383b47844abcbd77c1d64edd339a", "commit_date": "Tue Sep 27 12:32:40 2022 -0400", "commit_message": "Add password score validation", "files_name": ["README.md", "debian/control", "doc/configuration.md", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/tests/test_page_admin_users.py", "rdiffweb/controller/tests/test_page_prefs_general.py", "rdiffweb/core/config.py", "rdiffweb/core/model/_user.py", "setup.cfg"]}, {"commit_id": "1027c202e1d8f0162bc02913e6b51154925acb04", "commit_date": "Mon Sep 26 13:02:00 2022 -0400", "commit_message": "Add more secure headers: Cache-control, Referrer-Policy, X-Content-Type-Options, X-XSS-Protection", "files_name": ["README.md", "rdiffweb/controller/dispatch.py", "rdiffweb/controller/tests/test_secure_headers.py", "rdiffweb/tools/secure_headers.py"]}, {"commit_id": "d8b659d2953b893eb717dd7f411c36c1726ecc45", "commit_date": "Mon Sep 26 10:26:59 2022 -0400", "commit_message": "Update french translation", "files_name": ["rdiffweb/locales/fr/LC_MESSAGES/messages.po", "rdiffweb/locales/messages.pot"]}, {"commit_id": "b62c479ff6979563c7c23e7182942bc4f460a2c7", "commit_date": "Sun Sep 25 20:07:21 2022 -0400", "commit_message": "Limit user's fullname and Token name field length", "files_name": ["rdiffweb/controller/page_admin_users.py", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/page_pref_tokens.py", "rdiffweb/controller/tests/test_page_admin_users.py", "rdiffweb/controller/tests/test_page_prefs_general.py", "rdiffweb/controller/tests/test_page_prefs_tokens.py"]}, {"commit_id": "d1fb5abcd42b57c8274f6bba33573d524359fe42", "commit_date": "Sun Sep 25 16:59:58 2022 -0400", "commit_message": "Define field limit for SSH Key title", "files_name": ["README.md", "rdiffweb/controller/page_pref_sshkeys.py", "rdiffweb/controller/tests/test_page_prefs_ssh.py"]}, {"commit_id": "109e401ad74473ee5e59e7e6320d497eb1cfffdb", "commit_date": "Sat Sep 24 07:31:16 2022 -0400", "commit_message": "Define field limit for username, email and root directory #223", "files_name": ["README.md", "rdiffweb/controller/page_admin_users.py", "rdiffweb/controller/page_login.py", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/tests/test_page_admin_users.py", "rdiffweb/controller/tests/test_page_login.py", "rdiffweb/controller/tests/test_page_prefs_general.py"]}, {"commit_id": "5fbc544eede96333f22f08d6f92649a06e14a356", "commit_date": "Thu Sep 22 13:23:09 2022 -0400", "commit_message": "Clean-up invalid path on error page", "files_name": ["README.md", "rdiffweb/controller/tests/test_page_error.py", "rdiffweb/rdw_app.py"]}, {"commit_id": "836e5a181f24b077452671a8a3094dd5046a1468", "commit_date": "Wed Sep 21 10:48:37 2022 -0400", "commit_message": "Add test to verify CSRF in user's settings #221", "files_name": ["rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/tests/test_page_prefs_general.py"]}, {"commit_id": "102a92b28e6ced74be50b8e08bd2916642affafe", "commit_date": "Wed Sep 21 10:18:31 2022 -0400", "commit_message": "Generate a new session on login and 2FA #220", "files_name": ["README.md", "rdiffweb/controller/page_login.py", "rdiffweb/controller/tests/test_page_login.py", "rdiffweb/controller/tests/test_page_mfa.py", "rdiffweb/controller/tests/test_page_settings_set_encoding.py", "rdiffweb/tools/auth_form.py", "rdiffweb/tools/auth_mfa.py"]}, {"commit_id": "a7ca8e5fe1950e6011c75dbb7f22c660587c8503", "commit_date": "Tue Sep 20 11:54:01 2022 -0400", "commit_message": "Use 'Secure' Attribute with Sensitive Cookie in HTTPS Session on HTTP Error #218", "files_name": ["README.md", "rdiffweb/controller/tests/test_page_settings.py", "rdiffweb/controller/tests/test_page_settings_remove_older.py", "rdiffweb/controller/tests/test_page_settings_set_encoding.py", "rdiffweb/controller/tests/test_secure_headers.py", "rdiffweb/tools/secure_headers.py"]}, {"commit_id": "585cd65ecd2676de3597e76012bb2b214c08f0fd", "commit_date": "Tue Sep 20 10:55:47 2022 -0400", "commit_message": "Mitigate CSRF on repository settings #217", "files_name": ["README.md", "rdiffweb/controller/page_settings.py", "rdiffweb/controller/tests/test_page_settings.py", "rdiffweb/controller/tests/test_page_settings_remove_older.py", "rdiffweb/controller/tests/test_page_settings_set_encoding.py"]}, {"commit_id": "bfeb1d559c6953596eead6fd88573cc81e7fd566", "commit_date": "Mon Sep 19 13:53:05 2022 -0400", "commit_message": "Mitigate CSRF on notification #216", "files_name": ["rdiffweb/controller/page_pref_notification.py", "rdiffweb/controller/tests/test_page_prefs_notification.py", "rdiffweb/templates/prefs_notification.html"]}, {"commit_id": "928b591b1d0b3205eb1a189c6df2a0771f95bb48", "commit_date": "Tue Sep 20 07:33:32 2022 -0400", "commit_message": "Fix race condition for deletion", "files_name": ["rdiffweb/controller/page_delete.py"]}, {"commit_id": "db8dc0929d86cf8266c6194145d61be37a732869", "commit_date": "Tue Sep 20 07:40:14 2022 -0400", "commit_message": "Support MarkupSafe<3 for Debian bookworm", "files_name": ["setup.cfg", "tox.ini"]}, {"commit_id": "87677b87b6d0d9c9c04d2f700c98e1beab859371", "commit_date": "Mon Sep 19 09:58:32 2022 -0400", "commit_message": "Merge commit '422791ea45713aaaa865bdca74addb9fffd93a71'", "files_name": ["422791ea45713aaaa865bdca74addb9fffd93a71 - Fri Sep 16 11:38:46 2022 -0400 : Mitigate CSRF on repository deletion and user deletion #214 #215", "README.md", "rdiffweb/controller/page_admin.py", "rdiffweb/controller/page_delete.py", "rdiffweb/controller/pref_general.py", "rdiffweb/controller/tests/test_page_admin.py", "rdiffweb/controller/tests/test_page_delete.py"]}, {"commit_id": "6b19e52904cb2279d4c5d25d7fb358e257ea645d", "commit_date": "Thu Sep 15 16:59:04 2022 -0400", "commit_message": "Update X-Real-IP documentation", "files_name": ["doc/networking.md"]}, {"commit_id": "7030c1886a9d1c3d04f603b2918d0ef861a42148", "commit_date": "Thu Sep 15 16:33:50 2022 -0400", "commit_message": "Merge commit '28258e5dd85e7c417918ed3bf481e19ed5eff91f'", "files_name": ["28258e5dd85e7c417918ed3bf481e19ed5eff91f - Thu Sep 15 15:22:56 2022 -0400 : Use X-Real-IP to identify clients #213", "README.md", "doc/networking.md", "rdiffweb/controller/tests/test_page_login.py", "rdiffweb/main.py", "rdiffweb/rdw_app.py", "rdiffweb/tools/enrich_session.py", "rdiffweb/tools/real_ip.py"]}, {"commit_id": "7717a78a464b85b0f9b30ee5606d23a241f81a34", "commit_date": "Thu Sep 15 00:02:58 2022 +0000", "commit_message": "Merge branch 'patrik-mfa' into 'master'", "files_name": ["da081da06d489dee2b55e89fae69d39488af5dc7 - Wed Sep 14 11:48:05 2022 -0400 : Replace last warning message by flash", "rdiffweb/controller/page_history.py", "rdiffweb/core/__init__.py", "rdiffweb/templates/message.html"]}, {"commit_id": "5ce7777f59452f25ddae79eca30e0a4dca9e9b80", "commit_date": "Wed Sep 14 11:48:05 2022 -0400", "commit_message": "Exclude dock/conf.py from sonar analysis", "files_name": [".gitignore", ".gitlab-ci.yml", "sonar-project.properties"]}, {"commit_id": "9cd803fcdd2430cc137269aa69ca70df00ab414d", "commit_date": "Wed Sep 14 11:48:05 2022 -0400", "commit_message": "Implement Access Token Authentication for /api", "files_name": ["doc/access_tokens.md", "doc/usage.rst", "rdiffweb/controller/api.py", "rdiffweb/controller/page_pref_tokens.py", "rdiffweb/controller/page_prefs.py", "rdiffweb/controller/tests/test_api.py", "rdiffweb/controller/tests/test_page_prefs_tokens.py", "rdiffweb/core/model/__init__.py", "rdiffweb/core/model/_sshkey.py", "rdiffweb/core/model/_token.py", "rdiffweb/core/model/_user.py", "rdiffweb/core/model/tests/test_user.py", "rdiffweb/core/notification.py", "rdiffweb/templates/access_token_added.html", "rdiffweb/templates/message.html", "rdiffweb/templates/prefs.html", "rdiffweb/templates/prefs_tokens.html"]}, {"commit_id": "660795dfef9c56305599074d850c39a0622f784a", "commit_date": "Wed Sep 14 11:48:02 2022 -0400", "commit_message": "Add REST API to manage sshkeys", "files_name": ["README.md", "rdiffweb/controller/api.py", "rdiffweb/controller/dispatch.py", "rdiffweb/controller/page_pref_sshkeys.py", "rdiffweb/controller/tests/test_page_prefs_ssh.py", "rdiffweb/rdw_app.py"]}, {"commit_id": "dade9a9e92fb50772dddf4629d565112b458bec4", "commit_date": "Wed Sep 14 11:40:22 2022 -0400", "commit_message": "Implement Multi-Factor Authentication #201", "files_name": ["README.md"]}], "windows_after": [{"commit_id": "79ff50f1bb1841b76964871e339aabb67630d652", "commit_date": "Mon Oct 3 07:58:08 2022 -0400", "commit_message": "Mitigate path traversal vulnerability #227", "files_name": ["README.md", "rdiffweb/controller/dispatch.py", "rdiffweb/controller/tests/test_controller.py", "rdiffweb/rdw_app.py"]}, {"commit_id": "3af84978ef8b5d880604b6ae5cc6bf29c5567136", "commit_date": "Mon Oct 3 12:33:56 2022 +0000", "commit_message": "Merge branch 'patrik-fix-path-traversal' into 'master'", "files_name": ["be24bb6bbef0b380cb004955218719db6e89061b - Mon Oct 3 16:32:27 2022 -0400 : Support case insensitive column name #228", "rdiffweb/core/model/__init__.py"]}, {"commit_id": "a5d0bca218bd83c2e131767c061b0872969e9d23", "commit_date": "Tue Oct 4 11:24:16 2022 +0000", "commit_message": "Merge branch 'patrik-support-case-insensitive-column-name' into 'master'", "files_name": ["2ffc2af65c8f8113b06e0b89929c604bcdf844b9 - Sun Oct 2 08:31:05 2022 -0400 : Enforce password policy new password cannot be set as new password", "README.md", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/tests/test_page_prefs_general.py"]}, {"commit_id": "d49a25513995b76d2a08b41199954404e686a01a", "commit_date": "Tue Oct 4 12:29:45 2022 +0000", "commit_message": "Merge branch 'patrik-new-old-password' into 'master'", "files_name": ["b78ec09f4582e363f6f449df6f987127e126c311 - Tue Oct 11 14:46:08 2022 -0400 : Improve ratelimit implementation", "README.md", "doc/configuration.md", "rdiffweb/controller/api.py", "rdiffweb/controller/form.py", "rdiffweb/controller/page_admin_session.py", "rdiffweb/controller/page_login.py", "rdiffweb/controller/page_mfa.py", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/page_pref_session.py", "rdiffweb/controller/tests/test_api.py", "rdiffweb/controller/tests/test_page_login.py", "rdiffweb/controller/tests/test_page_prefs_general.py", "rdiffweb/core/config.py", "rdiffweb/rdw_app.py", "rdiffweb/tools/ratelimit.py"]}, {"commit_id": "8becdaf734b11dc277f7b41151c00f12851085f5", "commit_date": "Tue Oct 11 19:45:04 2022 +0000", "commit_message": "Merge branch 'patrik-improve-ratelimit' into 'master'", "files_name": ["afc1bdfab5161c74012ff2590a6ec49cc0d8fde0 - Tue Oct 11 17:21:04 2022 -0400 : Enforce 'Origin' validation", "README.md", "rdiffweb/controller/tests/test_secure_headers.py", "rdiffweb/tools/secure_headers.py"]}, {"commit_id": "7b3240425543fd5c859bb7472a614b73525a90cc", "commit_date": "Tue Oct 11 21:48:14 2022 +0000", "commit_message": "Merge branch 'patrik-validate-origin' into 'master'", "files_name": ["b8e0c2824368a4b728b063a12a27089421c9135c - Fri Oct 14 08:34:47 2022 -0400 : Add OpenSSF Best Practices Badge", "README.md"]}, {"commit_id": "fa4fd9daa651320d1aa0bc3aae57a1cea4126efa", "commit_date": "Mon Oct 17 22:31:30 2022 +0000", "commit_message": "Merge branch 'patrik-badge' into 'master'", "files_name": ["f2a32f2a9f3fb8be1a9432ac3d81d3aacdb13095 - Mon Oct 17 18:58:27 2022 -0400 : Define idle and absolute session timeout with agressive default to protect usage on public computer", "README.md", "doc/configuration.md", "rdiffweb/controller/tests/test_page_login.py", "rdiffweb/core/config.py", "rdiffweb/rdw_app.py", "rdiffweb/tools/auth_form.py"]}, {"commit_id": "72872975fccf1676f09d231eabf13ab739eaa36b", "commit_date": "Wed Oct 19 16:13:49 2022 +0000", "commit_message": "Merge branch 'patrik-limit-session' into 'master'", "files_name": ["c27c46bac656b1da74f28eac1b52dfa5df76e6f2 - Fri Oct 21 12:14:40 2022 -0400 : Send email notification when enabling or disabling MFA", "README.md", "rdiffweb/controller/page_mfa.py", "rdiffweb/controller/page_pref_mfa.py", "rdiffweb/controller/tests/test_page_prefs_mfa.py", "rdiffweb/core/config.py", "rdiffweb/core/model/_user.py", "rdiffweb/core/model/tests/test_user.py", "rdiffweb/core/notification.py", "rdiffweb/core/tests/test_notification.py", "rdiffweb/templates/email_mfa.html", "rdiffweb/templates/email_verification_code.html", "tox.ini"]}, {"commit_id": "de23b1c2ea51e2b1f05356b91b3ff0e80a4c3949", "commit_date": "Sun Oct 23 19:46:16 2022 +0000", "commit_message": "Merge branch 'patrik-mfa-notification' into 'master'", "files_name": ["397990b53dc5d28507f76e458aed915cdd97de57 - Mon Oct 24 12:22:13 2022 -0400 : Use argon2id to store password hash #231", "README.md", "debian/control", "rdiffweb/core/passwd.py", "rdiffweb/core/tests/test_passwd.py", "setup.cfg", "tox.ini"]}, {"commit_id": "159335f87ae8c5ea14bb7d1dfd11a037143b95a4", "commit_date": "Tue Oct 25 10:58:05 2022 +0000", "commit_message": "Merge branch 'patrik-password-hash' into 'master'", "files_name": ["7edc4285e45066cfdb3a0f879cf5f29f422010cd - Mon Oct 24 11:11:10 2022 -0400 : Improve testing of database upgrade", ".gitlab-ci.yml", "rdiffweb/core/model/_user.py", "rdiffweb/core/model/tests/test_db_after_create.py", "rdiffweb/core/model/tests/test_user.py"]}, {"commit_id": "3dabbcc2183fe5a079e1faaf8cff0c3b264aa7d6", "commit_date": "Tue Oct 25 12:58:38 2022 +0000", "commit_message": "Merge branch 'patrik-test-sql-upgrade' into 'master'", "files_name": ["36e3549cef24cfe1c2d068a5d433430375bd3f2c - Wed Oct 26 15:56:23 2022 -0400 : Force plugins ordering on startup #232", "README.md", "rdiffweb/core/notification.py", "rdiffweb/core/remove_older.py", "rdiffweb/core/tests/test_notification.py", "rdiffweb/core/tests/test_remove_older.py"]}, {"commit_id": "57eabe7f8f1f98915feaddfa1d9629bf7f561b54", "commit_date": "Fri Oct 28 19:32:35 2022 +0000", "commit_message": "Merge branch 'patrik-plugin-ordering' into 'master'", "files_name": ["a69d45c874d93fc73be353b3f556133191ec17ab - Tue Nov 1 11:49:37 2022 +0000 : Use python 3.10 to fix CICD pipeline", ".gitlab-ci.yml"]}, {"commit_id": "0757fda8fe064e36c63c868e1a3e31f754806261", "commit_date": "Tue Nov 1 11:49:38 2022 +0000", "commit_message": "Merge branch 'patrik-pipeline' into 'master'", "files_name": ["6efb995bc32c8a8e9ad755eb813dec991dffb2b8 - Tue Nov 1 18:59:49 2022 -0400 : Delete user's session on password change", "README.md", "rdiffweb/controller/api.py", "rdiffweb/controller/page_admin_session.py", "rdiffweb/controller/page_admin_users.py", "rdiffweb/controller/page_delete.py", "rdiffweb/controller/page_locations.py", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/page_pref_mfa.py", "rdiffweb/controller/page_pref_notification.py", "rdiffweb/controller/page_pref_session.py", "rdiffweb/controller/page_pref_sshkeys.py", "rdiffweb/controller/page_pref_tokens.py", "rdiffweb/controller/tests/test_api.py", "rdiffweb/controller/tests/test_controller.py", "rdiffweb/controller/tests/test_page_admin.py", "rdiffweb/controller/tests/test_page_admin_users.py", "rdiffweb/controller/tests/test_page_browse.py", "rdiffweb/controller/tests/test_page_delete.py", "rdiffweb/controller/tests/test_page_graphs.py", "rdiffweb/controller/tests/test_page_history.py", "rdiffweb/controller/tests/test_page_login.py", "rdiffweb/controller/tests/test_page_logs.py", "rdiffweb/controller/tests/test_page_mfa.py", "rdiffweb/controller/tests/test_page_prefs_general.py", "rdiffweb/controller/tests/test_page_prefs_mfa.py", "rdiffweb/controller/tests/test_page_prefs_ssh.py", "rdiffweb/controller/tests/test_page_prefs_tokens.py", "rdiffweb/controller/tests/test_page_restore.py", "rdiffweb/controller/tests/test_page_settings.py", "rdiffweb/controller/tests/test_page_settings_remove_older.py", "rdiffweb/controller/tests/test_page_settings_set_encoding.py", "rdiffweb/controller/tests/test_page_status.py", "rdiffweb/core/login.py", "rdiffweb/core/model/__init__.py", "rdiffweb/core/model/_repo.py", "rdiffweb/core/model/_session.py", "rdiffweb/core/model/_token.py", "rdiffweb/core/model/_user.py", "rdiffweb/core/model/tests/test_repo.py", "rdiffweb/core/model/tests/test_token.py", "rdiffweb/core/model/tests/test_user.py", "rdiffweb/core/tests/test_login.py", "rdiffweb/core/tests/test_notification.py", "rdiffweb/core/tests/test_quota.py", "rdiffweb/core/tests/test_rdw_templating.py", "rdiffweb/rdw_app.py", "rdiffweb/templates/access_token_added.html", "rdiffweb/test.py", "rdiffweb/tools/db.py"]}, {"commit_id": "b396bfb93ea01ef061ce6b6a4260bc0ba8d873fa", "commit_date": "Wed Nov 2 10:11:30 2022 -0400", "commit_message": "Identify persistent sessions with a badge", "files_name": ["rdiffweb/controller/page_admin_session.py", "rdiffweb/controller/page_pref_session.py", "rdiffweb/controller/tests/test_page_prefs_session.py", "rdiffweb/templates/admin_session.html", "rdiffweb/templates/prefs_session.html"]}, {"commit_id": "e1d9e7e4b27e4cb7f31ad2459b5cb6a8324feda7", "commit_date": "Wed Nov 2 14:53:42 2022 +0000", "commit_message": "Merge branch 'patrik-password-reset' into 'master'", "files_name": ["516b3d8d7c34b1baff50ba3ea035d9c7ff96f1e5 - Wed Nov 2 12:54:04 2022 -0400 : Raise `user_added` event before_insert", "rdiffweb/core/model/_user.py"]}, {"commit_id": "f77eb8c9a2b835eee253621b4f5c693e8b350316", "commit_date": "Wed Nov 2 15:18:53 2022 -0400", "commit_message": "Handle duplicate token name", "files_name": ["rdiffweb/controller/page_pref_tokens.py", "rdiffweb/controller/tests/test_page_prefs_tokens.py"]}, {"commit_id": "5990d9d0dd9c802ac6735d64c3230ea20b76ba73", "commit_date": "Wed Nov 2 15:42:00 2022 -0400", "commit_message": "Add rollback call where applicable", "files_name": ["rdiffweb/controller/page_admin_users.py", "rdiffweb/controller/page_pref_general.py", "rdiffweb/controller/page_pref_mfa.py", "rdiffweb/controller/page_pref_notification.py", "rdiffweb/controller/page_pref_sshkeys.py", "rdiffweb/controller/page_pref_tokens.py"]}, {"commit_id": "ba6f387704b631d835183cf3121de8932b54d34b", "commit_date": "Sun Nov 6 16:55:44 2022 -0500", "commit_message": "Improve CSS branding configuration #239", "files_name": ["README.md", "doc/configuration.md", "rdiffweb/controller/__init__.py", "rdiffweb/controller/tests/test_controller.py", "rdiffweb/controller/tests/test_secure_headers.py", "rdiffweb/core/config.py", "rdiffweb/rdw_app.py", "rdiffweb/static/blue.css", "rdiffweb/static/orange.css", "rdiffweb/templates/default.css", "rdiffweb/templates/layout.html", "rdiffweb/templates/login.html", "rdiffweb/test.py"]}, {"commit_id": "cc29583e301efdebf57d1fd6fbdc1e2d2ddd59c3", "commit_date": "Mon Nov 7 16:41:19 2022 +0000", "commit_message": "Merge branch 'patrik-adjust' into 'master'", "files_name": ["35f5968624a2a3e97b9974456ba3713260b6ba5b - Wed Nov 9 14:59:53 2022 -0500 : Update french translation", "rdiffweb/locales/en/LC_MESSAGES/messages.mo", "rdiffweb/locales/fr/LC_MESSAGES/messages.mo", "rdiffweb/locales/fr/LC_MESSAGES/messages.po", "rdiffweb/locales/messages.pot", "rdiffweb/templates/email_mfa.html"]}, {"commit_id": "44a2b075c21fe0858a2087c2e19175738622e13d", "commit_date": "Wed Nov 9 21:19:32 2022 +0000", "commit_message": "Merge branch 'patrik-update-french-translation' into 'master'", "files_name": ["a762f47138c60c6228e2062d4edc664a590e2974 - Mon Nov 14 07:43:41 2022 -0500 : Add support for Ubuntu Kinetic #240", ".gitlab-ci.yml", "README.md", "doc/installation.md"]}], "parents": [{"commit_id_before": "ee98e5af78ec60db8a17fef6ea0ca250e3f31eec", "url_before": "https://api.github.com/repos/ikus060/rdiffweb/commits/ee98e5af78ec60db8a17fef6ea0ca250e3f31eec", "html_url_before": "https://github.com/ikus060/rdiffweb/commit/ee98e5af78ec60db8a17fef6ea0ca250e3f31eec"}], "details": [{"raw_url": "https://github.com/ikus060/rdiffweb/raw/323383d1db656f1b1291be529947bd943a6b0e99/README.md", "code": "![Rdiffweb Banner](https://gitlab.com/ikus-soft/rdiffweb/-/raw/master/doc/_static/banner.png)\n\n<p align=\"center\">\n<strong>\n<a href=\"https://www.rdiffweb.org\">website</a>\n\u2022 <a href=\"https://www.ikus-soft.com/archive/rdiffweb/doc/latest/html/\">docs</a>\n\u2022 <a href=\"https://groups.google.com/d/forum/rdiffweb\">community</a>\n\u2022 <a href=\"https://rdiffweb-demo.ikus-soft.com/\">demo</a>\n</strong>\n</p>\n\n<p align=\"center\">\n<a href=\"LICENSE\"><img alt=\"License\" src=\"https://img.shields.io/github/license/ikus060/rdiffweb\"></a>\n<a href=\"https://gitlab.com/ikus-soft/rdiffweb/pipelines\"><img alt=\"Build\" src=\"https://gitlab.com/ikus-soft/rdiffweb/badges/master/pipeline.svg\"></a>\n<a href=\"https://sonar.ikus-soft.com/dashboard?id=rdiffweb\"><img alt=\"Quality Gate Minarca Client\" src=\"https://sonar.ikus-soft.com/api/project_badges/measure?project=rdiffweb&metric=alert_status\"></a>\n<a href=\"https://sonar.ikus-soft.com/dashboard?id=rdiffweb\"><img alt=\"Coverage\" src=\"https://sonar.ikus-soft.com/api/project_badges/measure?project=rdiffweb&metric=coverage\"></a>\n</p>\n\n<h1 align=\"center\">\nWelcome to Rdiffweb\n</h1>\n\nRdiffweb is a web application that allows you to view repositories generated\nby [rdiff-backup](https://rdiff-backup.net/). The purpose of this\napplication is to ease the management of backups and quickly restore your data\nwith a rich and powerful web interface.\n\nRdiffweb is written in Python and is released as open source project under the \nGNU GENERAL PUBLIC LICENSE (GPL). All source code and documentation are\nCopyright Rdiffweb contributors.\n\nRdiffweb is actively developed by [IKUS Soft](https://www.ikus-soft.com/)\nsince November 2014.\n\nThe Rdiffweb source code is hosted on [Gitlab](https://gitlab.com/ikus-soft/rdiffweb)\nand mirrored to [Github](https://github.com/ikus060/rdiffweb).\n\nThe Rdiffweb website is https://rdiffweb.org/.\n\n## Features\n\nWith its rich web interface Rdiffweb provide a notable list of features:\n\n * Browse your backup\n * Restore single file or multiple files as an archived\n * Users authentication via local database and LDAP\n * Users authorization\n * Email notification when backup is not successful\n * Configurable repository encoding\n * Configurable retention period\n * Backup statistics visualization using graphs\n * SSH Keys management\n * Disk quota visualization\n * File and folder deletion\n\n## Demo\n\nIf you quickly want to check how Rdiffweb is behaving, you may try our demo server hosted on:\n\n[https://rdiffweb-demo.ikus-soft.com/](https://rdiffweb-demo.ikus-soft.com/)\n\nUse the following credential to login:\n\n * Username: admin\n * Password: admin123\n\n## Installation & Docker usage\n\nFor detailed installation steps, read the [Installation documentation](https://www.ikus-soft.com/archive/rdiffweb/doc/latest/html/installation.html).\n\n## Current Build Status\n\n[![Build Status](https://gitlab.com/ikus-soft/rdiffweb/badges/master/pipeline.svg)](https://gitlab.com/ikus-soft/rdiffweb/pipelines)\n\n## Download\n\nYou should read the [Documentation](https://www.ikus-soft.com/archive/rdiffweb/doc/latest/html/index.html) to properly install Rdiffweb in your environment.\n\n**Docker**\n\n    docker pull ikus060/rdiffweb\n    \n**Debian**\n\n    curl -L https://www.ikus-soft.com/archive/rdiffweb/public.key | apt-key add - \n    echo \"deb https://nexus.ikus-soft.com/repository/apt-release-bullseye/ bullseye main\" > /etc/apt/sources.list.d/rdiffweb.list\n    apt update\n    apt install rdiffweb\n\n**Pypi**\n\n    pip install rdiffweb\n\n## Support\n\n### Mailing list\n\nRdiffweb users should use the [Rdiffweb mailing list](https://groups.google.com/forum/#!forum/rdiffweb).\n\n### Bug Reports\n\nBug reports should be reported on the Rdiffweb Gitlab at https://gitlab.com/ikus-soft/rdiffweb/-/issues\n\n### Professional support\n\nProfessional support for Rdiffweb is available by contacting [IKUS Soft](https://www.ikus-soft.com/en/support/#form).\n\n# Changelog\n\n## 2.4.10 (2022-10-03)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Mitigate path traversal vulnerability [CVE-2022-3389](https://nvd.nist.gov/vuln/detail/CVE-2022-3389)\n\n## 2.4.9 (2022-09-28)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Add `Cache-Control` and other security headers [CVE-2022-3292](https://nvd.nist.gov/vuln/detail/CVE-2022-3292)\n* Enforce password policy using `password-score` based on [zxcvbn](https://github.com/dropbox/zxcvbn) [CVE-2022-3326](https://nvd.nist.gov/vuln/detail/CVE-2022-3326)\n\n## 2.4.8 (2022-09-26)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Clean-up invalid path on error page\n* Limit username field length [CVE-2022-3290](https://nvd.nist.gov/vuln/detail/CVE-2022-3290)\n* Limit user's email field length [CVE-2022-3272](https://nvd.nist.gov/vuln/detail/CVE-2022-3272)\n* Limit user's root directory field length [CVE-2022-3295](https://nvd.nist.gov/vuln/detail/CVE-2022-3295)\n* Limit SSH Key title field length [CVE-2022-3298](https://nvd.nist.gov/vuln/detail/CVE-2022-3298)\n\n## 2.4.7 (2002-09-21)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Generate a new session on login and 2FA #220 [CVE-2022-3269](https://nvd.nist.gov/vuln/detail/CVE-2022-3269)\n* Mitigate CSRF on user's settings #221 [CVE-2022-3274](https://nvd.nist.gov/vuln/detail/CVE-2022-3274)\n\n## 2.4.6 (2022-09-20)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Support MarkupSafe<3 for Debian bookworm\n* Mitigate CSRF on user's notification settings #216 [CVE-2022-3233](https://nvd.nist.gov/vuln/detail/CVE-2022-3233)\n* Mitigate CSRF on repository settings #217 [CVE-2022-3267](https://nvd.nist.gov/vuln/detail/CVE-2022-3267)\n* Use 'Secure' Attribute with Sensitive Cookie in HTTPS Session on HTTP Error #218 [CVE-2022-3174](https://nvd.nist.gov/vuln/detail/CVE-2022-3174)\n\n## 2.4.5 (2002-09-16)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Mitigate CSRF on repository deletion and user deletion [CVE-2022-3232](https://nvd.nist.gov/vuln/detail/CVE-2022-3232) #214 #215\n\n## 2.4.4 (2002-09-15)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Use `X-Real-IP` to identify client IP address to mitigate Brute-Force attack #213\n\n## 2.4.3 (2022-09-14)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Mitigate CSRF in profile's SSH Keys [CVE-2022-3221](https://nvd.nist.gov/vuln/detail/CVE-2022-3221) #212\n\n## 2.4.2 (2022-09-12)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Use 'Secure' Attribute with Sensitive Cookie in HTTPS Session. [CVE-2022-3174](https://nvd.nist.gov/vuln/detail/CVE-2022-3174) #209\n* Avoid leakage of the stack trace in the default error page. [CVE-2022-3175](https://nvd.nist.gov/vuln/detail/CVE-2022-3175) #210\n* Enforce minimum and maximum password length [CVE-2022-3175](https://nvd.nist.gov/vuln/detail/CVE-2022-3179) #211\n\n## 2.4.1 (2022-09-08)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Add Clickjacking Defense [CVE-2022-3167](https://nvd.nist.gov/vuln/detail/CVE-2022-3167)\n* Drop Ubuntu Hirsute & Impish (End-of-life)\n\n## 2.4.0 (2022-06-21)\n\nThis new release brings a lot of improvement since the last version, multiple bug fixes\nto make the application stable. A couple of new features to improve the overall\nusability and a new security feature to block a brute force attack.\n\n* Add RateLimit to login page and API to mitigate robots attacks #167\n* Send email notification only if `email-sender` option is defined to avoid raising exception in logs #176\n* Support file restore cancellation without leaving `rdiffweb-restore` process in `<defunct>` state #174\n* Replace `python-ldap` by `ldap3` a pure python implementation to avoid dependencies on `sasl` and `ldap` binaries #186\n* Reffactor core module to allow better extendability and reusability #183\n* Add support for Debian Bookworm #180\n* Add support for Ubuntu Impish #175\n* Add rdiff-backup version to administration view\n* Run unit test during Debian build package\n* Refresh repository list automatically when required #188 #189\n* Fix error 500 displayed in status page #191\n* Improve repository browsing speed by minimizing the number of I/O call #192\n* Publish Docker image directly to DockerHub #144\n\nBreaking changes:\n\n* Ldap Password changes is not supported anymore.\n* Ldap Check Shadow expire config is not supported anymore. It should be replace by a custom filter.\n* Drop CentOS 7 and CentOS 8 support\n\n## 2.3.9 (2022-01-05)\n\nMaintenance release to fix minor issues\n\n* Improve date parsing for `backup.log` to avoid printing exception in logs #170\n* Return HTTP error 403 for invalid symlink to avoid returning a misleading HTTP 500 Server Error #168\n* Show a user friendly error message when trying to create a new user with an existing username #169\n* Handle repository without last-backup date during the notification process to ensure notifications are sent #171\n* Replace CherryPy `storage_type` by `storage_class` to avoid warning in logs\n* Update code to avoid deprecation warning where applicable\n* Add Flake8 validation to improve code quality\n* Remove Ubuntu Groovy support\n\n## 2.3.8 (2021-12-01)\n\n* Push all artefacts to nexus server including binaries and documentation\n* Fix `Chart.js` loading on Debian bullseye #164\n* Update installation steps documentation\n* Improve LDAP authentication to lookup entire directory\n* Fix usage of `--ldap-add-user-default-userroot` to avoid error related to wrong encoding\n* Improve authentication mechanics\n* Avoid raising an HTTP error 500 when login form receive invalid payload\n* Mitigate open redirect vulnerability in login form\n\n## 2.3.7 (2021-10-21)\n\n * To avoid backward compatibility issue, revert CSRF Token validation\n * Mitigate CSRF vulnerability using cookies with `SameSite=Lax`\n * Mitigate CSRF vulnerability by validating the `Origin` header when a form is submited\n * Improve usage of WTForm for all form validation\n * Update installation stepd for debian #162\n * Build Ubuntu packages and publish them to our APT repo\n\n## 2.3.6 (2021-10-20)\n\n * Broken build\n\n## 2.3.5 (2021-10-18)\n\n * Mitigate CSRF vulnerability to user, ssh and repo management with CSRF Token\n\n## 2.3.4 (2021-09-20)\n\n * Skip email notification if `email-host` configuration is not provided #157\n * Skip email notification when the new attribute value has the same value #159\n * USE LDAP `mail` attribute when creating new user from LDAP directory #156\n\n## 2.3.3 (2021-09-10)\n\n * Provide a new theme `blue` to match IKUS Soft colors #158\n\n## 2.3.2 (2021-09-07)\n\n * Automatically update user's repository list based on user's home directory\n\n## 2.3.1 (2021-07-14)\n\n * Update default `session-dir` location to `/var/lib/rdiffweb/session` to avoid using `/var/run` #148\n\n## 2.3.0 (2021-07-06)\n\n * Improve timezone handling to display date with local timezone using javascript #143\n * Improve charts by replacing d3js by chartkick #122\n * Replace the status view by something meaningful with chartkick #122\n * Provide Docker image with Rdiffweb `docker pull ikus060/rdiffweb` #55\n * Fix file and folder sorting #143\n\n## 2.2.0 (2021-05-11)\n \n * Debian package:\n   * Add rdiff-backup as dependencies to comply with Debian packaging rules\n   * Multiple other fixed to control files\n   * Use debhelper-compat (= 13)\n   * Use debhelper-compat (= 13)\n   * Run test during packaging\n   * Create default folder `/var/run/rdiffweb/sessions` to store user session\n * Use ConfigArgPare for configuration to support configuration file, environment variables and arguments to configure rdiffweb #114\n * Fix cache in localization module\n * Add `ldap-add-default-role` and `ldap-add-default-userroot` option to define default value for role and user root when creating user from LDAP #125\n * Support PostgreSQL database by replacing our storage layer by SQLAlchemy #126\n * Fix to retrieve user quota only for valid user_root #135\n * Add option `disable-ssh-keys` to disable SSH Key management\n * Use absolute URL everywhere\n * Add support for `X-Forwarded-For`, `X-Forwarded-proto` and other reverse proxy header when generating absolute URL\n * Drop Debian Stretch support\n * Implement a new background scheduler using apscheduler #82\n * Use background job to send email notification to avoid blocking web page loading #47\n * Use background job to delete repository to avoid blocking web page loading #48\n * Allow deleting a specific file or folder from the history using `rdiff-backup-delete` #128\n * Improve support for `session-dir` #131\n * Add option `admin-password` to define administrator password for better security\n * Improve performance of repository browsing \n * Add a new view to display logs of a specific repository\n * Allow downloading the log\n * Define a default limit to graph statistics to make it display faster\n * Fix `get-quota-cmd` option to properly return a value\n\n## 2.1.0 (2021-01-15)\n\n* Debian package: Remove dh-systemd from Debian build dependencies (https://bugs.debian.org/871312we)\n* Improve Quota management:\n  * `QuotaSetCmd`, `QuotaGetCmd` and `QuotaUsedCmd` options could be used to customize how to set the quota for your environment.\n  * Display user's quota in User View\n  * Display user's quota in Admin View\n  * Allow admin to update user quota from Admin View when `QuotaSetCmd` is defined.\n  * Allow admin to define user quota using human readable value (e.g.: GiB, TiB, etc.)\n  * Improve logging around quota management\n* Improve robustness when service is starting\n* Improve robustness when repository has wrong permission defined (e.g.: when some files not readable)\n* Add user id in Admin view\n* Replace `UserObject(1)` by the actual username in log file to improve debugging\n\n## 2.0.0 (2020-12-04)\n\n* Re-implement logic to update repositories views to remove duplicates and avoid nesting repo. #107\n* Handle elapsed time of days in the graph. Thanks [Nathaniel van Diepen](https://github.com/Eeems) contributions.\n* Rebrand all link to ikus-soft.com\n* Update documentation to install rdiffweb\n* Remove obsolete minify dependency\n* Drop support for python2\n* Provide null translation if translation catalogues are not found\n* Pass a LANG environment variable to rdiff-backup restore process to fix encoding issue #112\n* Remove obsolete python shebang\n* Remove execution bit (+x) on python modules\n* Provide `--help` and `--version` on `rdiffweb` executable\n* Improve cherrypy version detection\n* Do not update translation files (.mo) during build\n\n## 1.5.0 (2020-06-24)\n\nThis minor release introduce official support of rdiffweb on Debian Bullseye. It also includes some usability improvements.\n\n * Change formatting of Last Backup date for \"Updated 3 weeks ago\" to ease the readability\n * Add support for Debian Bullseye\n * Add support for Python 3.8 (#104)\n * Add warning in the users list view when a root directory is invalid (#30)\n * Add options to control search depthness (#1)\n * Print a warning in the log when the \"DefaultTheme\" value is not valid (#90)\n\n## 1.4.0 (2020-05-20)\n\nThanks to our sponsor, this release introduce a feature to have better control over the user's permission by defining 3 different levels of privilege: Admin, Maintainer and User. This addition allows you to have better control on what your users can or can't do.\n\n * Fix single repository discovery when a user's home is a rdiff-backup repository\n * [SPONSORED] Add a new setting at the user level to define the user's role. Admin,\n   Maintainer and User. Admin are allowed to do everything. Maintainer are\n   allow to browse and delete repo. Users are only allowed to browse. #94\n * Add \"Powered by\" in the web interface footer #91\n * Display a nice error message when trying to delete admin user #93\n * Introduce usage of wtforms and flash in admin users for better form validation. #96 #97\n * Update French translation\n\n## 1.3.2 (2020-04-23)\n\nThis minor releases fixed issues found while testing release 1.3.0.\n\n * Fix lookup of executable rdiff-backup and rdiffweb-restore to search in current virtualenv first\n * Fix repository view when multiple repo path are conflicting\n * Fix logging of rdiffweb-restore subprocess\n\n## 1.3.1 (2020-04-10)\n\nThis minor release enforces security of the password stored in rdiffweb database to make use of a better encryption using SSHA.\nOnly new passwords will make use of the SSHA scheme.\n\n * Enforce password encryption by using SSHA scheme #88\n\n## 1.3.0 (2020-04-07)\n\nThis release focuses on improving the restore of big archives. The download should be much faster to start. Major enhancement was made to offload the processing outside the web server. And all of this is still compatible with rdiff-backup v1.2.8 and the latest v2.0.0.\n\n * Restore file and folder in a subprocess to make the download start faster\n * Fix encoding of archive on Python3.6 (CentOS 7) by using PAX format\n * Add support to restore files and folders using rdiff-backup2\n * Remove obsolete dependencies `pysqlite2`\n * Fix issue creating duplicate entries of repository in the database\n\n## 1.2.2 (2020-03-05)\n\nThis release provides little improvement to the v1.2.x including official support of rdiff-backup v2.0.0.\n\n * Enhance the repository to invite users to refresh the repository when the view is empty.\n * Support rdiff-backup v2.0.0\n * Deprecate support for cherrypy 4, 5, 6 and 7\n * Improve loading of repository data (cache status and entries)\n * Restore compatibility with SQLite 3.7 (CentOS7)\n\nKnown issues:\n\n * Filename encoding in tar.gz and zip file might not be accurate if you are running Python 3.6 (CentOS7)\n\n\n## 1.2.1 (2020-02-08)\n\nLittle bug fix following the previous release\n\n * Fix 404 error when trying to access other users repo as admin\n * Fix logging format for cherrypy logs to matches rdiffweb format\n * Add log rotation by default\n\n## 1.2.0 (2020-01-30)\n\nThis release focus on improving the database layers for better extendability to add more type of data and to support more databases backend like postgresql in the near future.\n\n * Add explicit testing for Debian Stretch & Buster\n * Change the persistence layers\n   * Minimize number of SQL queries\n   * Add object lazy loading\n   * Add object data caching\n * Fix bugs with SQLite <= 3.16 (Debian Stretch)\n\n## 1.1.0 (2019-10-31)\n\nThis release focus on improving the admin area and building the fundation for repository access control list (ACL).\n\n * Update documentation from PDSL web site\n * Improve the navigation bar layout\n * Update the login page headline\n * Update jinja2 version to allow 2.10.x\n * Show server log in admin area\n * Reduce code smell\n * Add System information in admin area\n * Validate credential using local database before LDAP\n * Reffactoring templates macros\n * Enhance user's view search bar\n * Change repository URL to username/repopath\n * Add System information in admin area\n * Improve testcases\n * Clean-up obsolete code\n * Fix issue with captital case encoding name\n * Fix compilation of less files\n * Fix google font import\n\n## 1.0.3 (2019-10-04)\n * Removing the auto update repos\n\n## 1.0.2 (2019-10-01)\n * Create \"admin\" user if missing\n * Update french translation\n\n## 1.0.1 (2019-09-22)\n * Update installation documentation \n * Fix removal of SSH Key\n * Return meaningful error to the user trying to add an existing SSH key\n\n## 1.0.0 (2019-09-11)\n * Make repository removal more robust\n * Improve performance of librdiff\n * Add new RESTful api\n * Return the right HTTP 401 or 402 error code for authentication\n * Fix bug introduce by upgrade to Jinja2 + python3\n * Store ssh keys in database and disk\n * Add support for theme (default, orange)\n * Remove deprecated profiling code\n * Add disk usage support / quota\n * Add support of cherrypy v18\n * Drop support of cherrypy v3.2.2\n * Add wsgi entry point\n * Replace the plugins architecture to ease implementation\n * Numerous bug fixes\n\n## 0.10.9 (2019-05-22)\n * Better error handling when error.log file are not valid gzip file\n\n", "code_before": "![Rdiffweb Banner](https://gitlab.com/ikus-soft/rdiffweb/-/raw/master/doc/_static/banner.png)\n\n<p align=\"center\">\n<strong>\n<a href=\"https://www.rdiffweb.org\">website</a>\n\u2022 <a href=\"https://www.ikus-soft.com/archive/rdiffweb/doc/latest/html/\">docs</a>\n\u2022 <a href=\"https://groups.google.com/d/forum/rdiffweb\">community</a>\n\u2022 <a href=\"https://rdiffweb-demo.ikus-soft.com/\">demo</a>\n</strong>\n</p>\n\n<p align=\"center\">\n<a href=\"LICENSE\"><img alt=\"License\" src=\"https://img.shields.io/github/license/ikus060/rdiffweb\"></a>\n<a href=\"https://gitlab.com/ikus-soft/rdiffweb/pipelines\"><img alt=\"Build\" src=\"https://gitlab.com/ikus-soft/rdiffweb/badges/master/pipeline.svg\"></a>\n<a href=\"https://sonar.ikus-soft.com/dashboard?id=rdiffweb\"><img alt=\"Quality Gate Minarca Client\" src=\"https://sonar.ikus-soft.com/api/project_badges/measure?project=rdiffweb&metric=alert_status\"></a>\n<a href=\"https://sonar.ikus-soft.com/dashboard?id=rdiffweb\"><img alt=\"Coverage\" src=\"https://sonar.ikus-soft.com/api/project_badges/measure?project=rdiffweb&metric=coverage\"></a>\n</p>\n\n<h1 align=\"center\">\nWelcome to Rdiffweb\n</h1>\n\nRdiffweb is a web application that allows you to view repositories generated\nby [rdiff-backup](https://rdiff-backup.net/). The purpose of this\napplication is to ease the management of backups and quickly restore your data\nwith a rich and powerful web interface.\n\nRdiffweb is written in Python and is released as open source project under the \nGNU GENERAL PUBLIC LICENSE (GPL). All source code and documentation are\nCopyright Rdiffweb contributors.\n\nRdiffweb is actively developed by [IKUS Soft](https://www.ikus-soft.com/)\nsince November 2014.\n\nThe Rdiffweb source code is hosted on [Gitlab](https://gitlab.com/ikus-soft/rdiffweb)\nand mirrored to [Github](https://github.com/ikus060/rdiffweb).\n\nThe Rdiffweb website is https://rdiffweb.org/.\n\n## Features\n\nWith its rich web interface Rdiffweb provide a notable list of features:\n\n * Browse your backup\n * Restore single file or multiple files as an archived\n * Users authentication via local database and LDAP\n * Users authorization\n * Email notification when backup is not successful\n * Configurable repository encoding\n * Configurable retention period\n * Backup statistics visualization using graphs\n * SSH Keys management\n * Disk quota visualization\n * File and folder deletion\n\n## Demo\n\nIf you quickly want to check how Rdiffweb is behaving, you may try our demo server hosted on:\n\n[https://rdiffweb-demo.ikus-soft.com/](https://rdiffweb-demo.ikus-soft.com/)\n\nUse the following credential to login:\n\n * Username: admin\n * Password: admin123\n\n## Installation & Docker usage\n\nFor detailed installation steps, read the [Installation documentation](https://www.ikus-soft.com/archive/rdiffweb/doc/latest/html/installation.html).\n\n## Current Build Status\n\n[![Build Status](https://gitlab.com/ikus-soft/rdiffweb/badges/master/pipeline.svg)](https://gitlab.com/ikus-soft/rdiffweb/pipelines)\n\n## Download\n\nYou should read the [Documentation](https://www.ikus-soft.com/archive/rdiffweb/doc/latest/html/index.html) to properly install Rdiffweb in your environment.\n\n**Docker**\n\n    docker pull ikus060/rdiffweb\n    \n**Debian**\n\n    curl -L https://www.ikus-soft.com/archive/rdiffweb/public.key | apt-key add - \n    echo \"deb https://nexus.ikus-soft.com/repository/apt-release-bullseye/ bullseye main\" > /etc/apt/sources.list.d/rdiffweb.list\n    apt update\n    apt install rdiffweb\n\n**Pypi**\n\n    pip install rdiffweb\n\n## Support\n\n### Mailing list\n\nRdiffweb users should use the [Rdiffweb mailing list](https://groups.google.com/forum/#!forum/rdiffweb).\n\n### Bug Reports\n\nBug reports should be reported on the Rdiffweb Gitlab at https://gitlab.com/ikus-soft/rdiffweb/-/issues\n\n### Professional support\n\nProfessional support for Rdiffweb is available by contacting [IKUS Soft](https://www.ikus-soft.com/en/support/#form).\n\n# Changelog\n\n## 2.4.9 (2002-09-28)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Add `Cache-Control` and other security headers [CVE-2022-3292](https://nvd.nist.gov/vuln/detail/CVE-2022-3292)\n* Enforce password policy using `password-score` based on [zxcvbn](https://github.com/dropbox/zxcvbn) [CVE-2022-3326](https://nvd.nist.gov/vuln/detail/CVE-2022-3326)\n\n## 2.4.8 (2022-09-26)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Clean-up invalid path on error page\n* Limit username field length [CVE-2022-3290](https://nvd.nist.gov/vuln/detail/CVE-2022-3290)\n* Limit user's email field length [CVE-2022-3272](https://nvd.nist.gov/vuln/detail/CVE-2022-3272)\n* Limit user's root directory field length [CVE-2022-3295](https://nvd.nist.gov/vuln/detail/CVE-2022-3295)\n* Limit SSH Key title field length [CVE-2022-3298](https://nvd.nist.gov/vuln/detail/CVE-2022-3298)\n\n## 2.4.7 (2002-09-21)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Generate a new session on login and 2FA #220 [CVE-2022-3269](https://nvd.nist.gov/vuln/detail/CVE-2022-3269)\n* Mitigate CSRF on user's settings #221 [CVE-2022-3274](https://nvd.nist.gov/vuln/detail/CVE-2022-3274)\n\n## 2.4.6 (2022-09-20)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Support MarkupSafe<3 for Debian bookworm\n* Mitigate CSRF on user's notification settings #216 [CVE-2022-3233](https://nvd.nist.gov/vuln/detail/CVE-2022-3233)\n* Mitigate CSRF on repository settings #217 [CVE-2022-3267](https://nvd.nist.gov/vuln/detail/CVE-2022-3267)\n* Use 'Secure' Attribute with Sensitive Cookie in HTTPS Session on HTTP Error #218 [CVE-2022-3174](https://nvd.nist.gov/vuln/detail/CVE-2022-3174)\n\n## 2.4.5 (2002-09-16)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Mitigate CSRF on repository deletion and user deletion [CVE-2022-3232](https://nvd.nist.gov/vuln/detail/CVE-2022-3232) #214 #215\n\n## 2.4.4 (2002-09-15)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Use `X-Real-IP` to identify client IP address to mitigate Brute-Force attack #213\n\n## 2.4.3 (2022-09-14)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Mitigate CSRF in profile's SSH Keys [CVE-2022-3221](https://nvd.nist.gov/vuln/detail/CVE-2022-3221) #212\n\n## 2.4.2 (2022-09-12)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Use 'Secure' Attribute with Sensitive Cookie in HTTPS Session. [CVE-2022-3174](https://nvd.nist.gov/vuln/detail/CVE-2022-3174) #209\n* Avoid leakage of the stack trace in the default error page. [CVE-2022-3175](https://nvd.nist.gov/vuln/detail/CVE-2022-3175) #210\n* Enforce minimum and maximum password length [CVE-2022-3175](https://nvd.nist.gov/vuln/detail/CVE-2022-3179) #211\n\n## 2.4.1 (2022-09-08)\n\nThis releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n\n* Add Clickjacking Defense [CVE-2022-3167](https://nvd.nist.gov/vuln/detail/CVE-2022-3167)\n* Drop Ubuntu Hirsute & Impish (End-of-life)\n\n## 2.4.0 (2022-06-21)\n\nThis new release brings a lot of improvement since the last version, multiple bug fixes\nto make the application stable. A couple of new features to improve the overall\nusability and a new security feature to block a brute force attack.\n\n* Add RateLimit to login page and API to mitigate robots attacks #167\n* Send email notification only if `email-sender` option is defined to avoid raising exception in logs #176\n* Support file restore cancellation without leaving `rdiffweb-restore` process in `<defunct>` state #174\n* Replace `python-ldap` by `ldap3` a pure python implementation to avoid dependencies on `sasl` and `ldap` binaries #186\n* Reffactor core module to allow better extendability and reusability #183\n* Add support for Debian Bookworm #180\n* Add support for Ubuntu Impish #175\n* Add rdiff-backup version to administration view\n* Run unit test during Debian build package\n* Refresh repository list automatically when required #188 #189\n* Fix error 500 displayed in status page #191\n* Improve repository browsing speed by minimizing the number of I/O call #192\n* Publish Docker image directly to DockerHub #144\n\nBreaking changes:\n\n* Ldap Password changes is not supported anymore.\n* Ldap Check Shadow expire config is not supported anymore. It should be replace by a custom filter.\n* Drop CentOS 7 and CentOS 8 support\n\n## 2.3.9 (2022-01-05)\n\nMaintenance release to fix minor issues\n\n* Improve date parsing for `backup.log` to avoid printing exception in logs #170\n* Return HTTP error 403 for invalid symlink to avoid returning a misleading HTTP 500 Server Error #168\n* Show a user friendly error message when trying to create a new user with an existing username #169\n* Handle repository without last-backup date during the notification process to ensure notifications are sent #171\n* Replace CherryPy `storage_type` by `storage_class` to avoid warning in logs\n* Update code to avoid deprecation warning where applicable\n* Add Flake8 validation to improve code quality\n* Remove Ubuntu Groovy support\n\n## 2.3.8 (2021-12-01)\n\n* Push all artefacts to nexus server including binaries and documentation\n* Fix `Chart.js` loading on Debian bullseye #164\n* Update installation steps documentation\n* Improve LDAP authentication to lookup entire directory\n* Fix usage of `--ldap-add-user-default-userroot` to avoid error related to wrong encoding\n* Improve authentication mechanics\n* Avoid raising an HTTP error 500 when login form receive invalid payload\n* Mitigate open redirect vulnerability in login form\n\n## 2.3.7 (2021-10-21)\n\n * To avoid backward compatibility issue, revert CSRF Token validation\n * Mitigate CSRF vulnerability using cookies with `SameSite=Lax`\n * Mitigate CSRF vulnerability by validating the `Origin` header when a form is submited\n * Improve usage of WTForm for all form validation\n * Update installation stepd for debian #162\n * Build Ubuntu packages and publish them to our APT repo\n\n## 2.3.6 (2021-10-20)\n\n * Broken build\n\n## 2.3.5 (2021-10-18)\n\n * Mitigate CSRF vulnerability to user, ssh and repo management with CSRF Token\n\n## 2.3.4 (2021-09-20)\n\n * Skip email notification if `email-host` configuration is not provided #157\n * Skip email notification when the new attribute value has the same value #159\n * USE LDAP `mail` attribute when creating new user from LDAP directory #156\n\n## 2.3.3 (2021-09-10)\n\n * Provide a new theme `blue` to match IKUS Soft colors #158\n\n## 2.3.2 (2021-09-07)\n\n * Automatically update user's repository list based on user's home directory\n\n## 2.3.1 (2021-07-14)\n\n * Update default `session-dir` location to `/var/lib/rdiffweb/session` to avoid using `/var/run` #148\n\n## 2.3.0 (2021-07-06)\n\n * Improve timezone handling to display date with local timezone using javascript #143\n * Improve charts by replacing d3js by chartkick #122\n * Replace the status view by something meaningful with chartkick #122\n * Provide Docker image with Rdiffweb `docker pull ikus060/rdiffweb` #55\n * Fix file and folder sorting #143\n\n## 2.2.0 (2021-05-11)\n \n * Debian package:\n   * Add rdiff-backup as dependencies to comply with Debian packaging rules\n   * Multiple other fixed to control files\n   * Use debhelper-compat (= 13)\n   * Use debhelper-compat (= 13)\n   * Run test during packaging\n   * Create default folder `/var/run/rdiffweb/sessions` to store user session\n * Use ConfigArgPare for configuration to support configuration file, environment variables and arguments to configure rdiffweb #114\n * Fix cache in localization module\n * Add `ldap-add-default-role` and `ldap-add-default-userroot` option to define default value for role and user root when creating user from LDAP #125\n * Support PostgreSQL database by replacing our storage layer by SQLAlchemy #126\n * Fix to retrieve user quota only for valid user_root #135\n * Add option `disable-ssh-keys` to disable SSH Key management\n * Use absolute URL everywhere\n * Add support for `X-Forwarded-For`, `X-Forwarded-proto` and other reverse proxy header when generating absolute URL\n * Drop Debian Stretch support\n * Implement a new background scheduler using apscheduler #82\n * Use background job to send email notification to avoid blocking web page loading #47\n * Use background job to delete repository to avoid blocking web page loading #48\n * Allow deleting a specific file or folder from the history using `rdiff-backup-delete` #128\n * Improve support for `session-dir` #131\n * Add option `admin-password` to define administrator password for better security\n * Improve performance of repository browsing \n * Add a new view to display logs of a specific repository\n * Allow downloading the log\n * Define a default limit to graph statistics to make it display faster\n * Fix `get-quota-cmd` option to properly return a value\n\n## 2.1.0 (2021-01-15)\n\n* Debian package: Remove dh-systemd from Debian build dependencies (https://bugs.debian.org/871312we)\n* Improve Quota management:\n  * `QuotaSetCmd`, `QuotaGetCmd` and `QuotaUsedCmd` options could be used to customize how to set the quota for your environment.\n  * Display user's quota in User View\n  * Display user's quota in Admin View\n  * Allow admin to update user quota from Admin View when `QuotaSetCmd` is defined.\n  * Allow admin to define user quota using human readable value (e.g.: GiB, TiB, etc.)\n  * Improve logging around quota management\n* Improve robustness when service is starting\n* Improve robustness when repository has wrong permission defined (e.g.: when some files not readable)\n* Add user id in Admin view\n* Replace `UserObject(1)` by the actual username in log file to improve debugging\n\n## 2.0.0 (2020-12-04)\n\n* Re-implement logic to update repositories views to remove duplicates and avoid nesting repo. #107\n* Handle elapsed time of days in the graph. Thanks [Nathaniel van Diepen](https://github.com/Eeems) contributions.\n* Rebrand all link to ikus-soft.com\n* Update documentation to install rdiffweb\n* Remove obsolete minify dependency\n* Drop support for python2\n* Provide null translation if translation catalogues are not found\n* Pass a LANG environment variable to rdiff-backup restore process to fix encoding issue #112\n* Remove obsolete python shebang\n* Remove execution bit (+x) on python modules\n* Provide `--help` and `--version` on `rdiffweb` executable\n* Improve cherrypy version detection\n* Do not update translation files (.mo) during build\n\n## 1.5.0 (2020-06-24)\n\nThis minor release introduce official support of rdiffweb on Debian Bullseye. It also includes some usability improvements.\n\n * Change formatting of Last Backup date for \"Updated 3 weeks ago\" to ease the readability\n * Add support for Debian Bullseye\n * Add support for Python 3.8 (#104)\n * Add warning in the users list view when a root directory is invalid (#30)\n * Add options to control search depthness (#1)\n * Print a warning in the log when the \"DefaultTheme\" value is not valid (#90)\n\n## 1.4.0 (2020-05-20)\n\nThanks to our sponsor, this release introduce a feature to have better control over the user's permission by defining 3 different levels of privilege: Admin, Maintainer and User. This addition allows you to have better control on what your users can or can't do.\n\n * Fix single repository discovery when a user's home is a rdiff-backup repository\n * [SPONSORED] Add a new setting at the user level to define the user's role. Admin,\n   Maintainer and User. Admin are allowed to do everything. Maintainer are\n   allow to browse and delete repo. Users are only allowed to browse. #94\n * Add \"Powered by\" in the web interface footer #91\n * Display a nice error message when trying to delete admin user #93\n * Introduce usage of wtforms and flash in admin users for better form validation. #96 #97\n * Update French translation\n\n## 1.3.2 (2020-04-23)\n\nThis minor releases fixed issues found while testing release 1.3.0.\n\n * Fix lookup of executable rdiff-backup and rdiffweb-restore to search in current virtualenv first\n * Fix repository view when multiple repo path are conflicting\n * Fix logging of rdiffweb-restore subprocess\n\n## 1.3.1 (2020-04-10)\n\nThis minor release enforces security of the password stored in rdiffweb database to make use of a better encryption using SSHA.\nOnly new passwords will make use of the SSHA scheme.\n\n * Enforce password encryption by using SSHA scheme #88\n\n## 1.3.0 (2020-04-07)\n\nThis release focuses on improving the restore of big archives. The download should be much faster to start. Major enhancement was made to offload the processing outside the web server. And all of this is still compatible with rdiff-backup v1.2.8 and the latest v2.0.0.\n\n * Restore file and folder in a subprocess to make the download start faster\n * Fix encoding of archive on Python3.6 (CentOS 7) by using PAX format\n * Add support to restore files and folders using rdiff-backup2\n * Remove obsolete dependencies `pysqlite2`\n * Fix issue creating duplicate entries of repository in the database\n\n## 1.2.2 (2020-03-05)\n\nThis release provides little improvement to the v1.2.x including official support of rdiff-backup v2.0.0.\n\n * Enhance the repository to invite users to refresh the repository when the view is empty.\n * Support rdiff-backup v2.0.0\n * Deprecate support for cherrypy 4, 5, 6 and 7\n * Improve loading of repository data (cache status and entries)\n * Restore compatibility with SQLite 3.7 (CentOS7)\n\nKnown issues:\n\n * Filename encoding in tar.gz and zip file might not be accurate if you are running Python 3.6 (CentOS7)\n\n\n## 1.2.1 (2020-02-08)\n\nLittle bug fix following the previous release\n\n * Fix 404 error when trying to access other users repo as admin\n * Fix logging format for cherrypy logs to matches rdiffweb format\n * Add log rotation by default\n\n## 1.2.0 (2020-01-30)\n\nThis release focus on improving the database layers for better extendability to add more type of data and to support more databases backend like postgresql in the near future.\n\n * Add explicit testing for Debian Stretch & Buster\n * Change the persistence layers\n   * Minimize number of SQL queries\n   * Add object lazy loading\n   * Add object data caching\n * Fix bugs with SQLite <= 3.16 (Debian Stretch)\n\n## 1.1.0 (2019-10-31)\n\nThis release focus on improving the admin area and building the fundation for repository access control list (ACL).\n\n * Update documentation from PDSL web site\n * Improve the navigation bar layout\n * Update the login page headline\n * Update jinja2 version to allow 2.10.x\n * Show server log in admin area\n * Reduce code smell\n * Add System information in admin area\n * Validate credential using local database before LDAP\n * Reffactoring templates macros\n * Enhance user's view search bar\n * Change repository URL to username/repopath\n * Add System information in admin area\n * Improve testcases\n * Clean-up obsolete code\n * Fix issue with captital case encoding name\n * Fix compilation of less files\n * Fix google font import\n\n## 1.0.3 (2019-10-04)\n * Removing the auto update repos\n\n## 1.0.2 (2019-10-01)\n * Create \"admin\" user if missing\n * Update french translation\n\n## 1.0.1 (2019-09-22)\n * Update installation documentation \n * Fix removal of SSH Key\n * Return meaningful error to the user trying to add an existing SSH key\n\n## 1.0.0 (2019-09-11)\n * Make repository removal more robust\n * Improve performance of librdiff\n * Add new RESTful api\n * Return the right HTTP 401 or 402 error code for authentication\n * Fix bug introduce by upgrade to Jinja2 + python3\n * Store ssh keys in database and disk\n * Add support for theme (default, orange)\n * Remove deprecated profiling code\n * Add disk usage support / quota\n * Add support of cherrypy v18\n * Drop support of cherrypy v3.2.2\n * Add wsgi entry point\n * Replace the plugins architecture to ease implementation\n * Numerous bug fixes\n\n## 0.10.9 (2019-05-22)\n * Better error handling when error.log file are not valid gzip file\n\n", "patch": "@@ -107,7 +107,13 @@ Professional support for Rdiffweb is available by contacting [IKUS Soft](https:/\n \n # Changelog\n \n-## 2.4.9 (2002-09-28)\n+## 2.4.10 (2022-10-03)\n+\n+This releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n+\n+* Mitigate path traversal vulnerability [CVE-2022-3389](https://nvd.nist.gov/vuln/detail/CVE-2022-3389)\n+\n+## 2.4.9 (2022-09-28)\n \n This releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n ", "file_path": "files/2022_10/665", "file_language": "md", "file_name": "README.md", "outdated_file_modify": 1, "outdated_file_before": 0, "outdated_file_after": 1}, {"raw_url": "https://github.com/ikus060/rdiffweb/raw/323383d1db656f1b1291be529947bd943a6b0e99/rdiffweb%2Fcontroller%2Fdispatch.py", "code": "# -*- coding: utf-8 -*-\n# rdiffweb, A web interface to rdiff-backup repositories\n# Copyright (C) 2012-2021 rdiffweb contributors\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\"\"\"\nDefault page handler\n\n@author: Patrik Dufresne <patrik@ikus-soft.com>\n\"\"\"\n\n\nimport cherrypy\n\nfrom rdiffweb.core.rdw_helpers import unquote_url\n\n\ndef poppath(*args, **kwargs):\n    \"\"\"\n    A decorator for _cp_dispatch\n    (cherrypy.dispatch.Dispatcher.dispatch_method_name).\n\n    Used to merge the segment of URI into a single parameter denoting the\n    repository path.\n    \"\"\"\n\n    # Since keyword arg comes after *args, we have to process it ourselves\n    # for lower versions of python.\n\n    handler = None\n    handler_call = False\n    for k, v in kwargs.items():\n        if k == 'handler':\n            handler = v\n        else:\n            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))\n\n    import inspect\n\n    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):\n        handler_call = True\n\n    def decorated(cls_or_self=None, vpath=None):\n        if inspect.isclass(cls_or_self):\n            # cherrypy.poppath is a class decorator\n            cls = cls_or_self\n            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)\n            return cls\n\n        # We're in the actual function\n        self = cls_or_self\n        parms = {}\n        for arg in args:\n            if not vpath:\n                break\n            parms[arg] = unquote_url(vpath.pop(0))\n\n        # Build repo path.\n        path = []\n        while len(vpath) > 0:\n            path.append(unquote_url(vpath.pop(0)))\n        parms['path'] = b\"/\".join(path)\n\n        if handler is not None:\n            if handler_call:\n                return handler(**parms)\n            else:\n                cherrypy.request.params.update(parms)  # @UndefinedVariable\n                return handler\n\n        cherrypy.request.params.update(parms)  # @UndefinedVariable\n\n        # If we are the ultimate handler, then to prevent our _cp_dispatch\n        # from being called again, we will resolve remaining elements through\n        # getattr() directly.\n        if vpath:\n            return getattr(self, vpath.pop(0), None)\n        else:\n            return self\n\n    return decorated\n\n\ndef staticdir(path):\n    \"\"\"\n    Create a page handler to serve static directory.\n    \"\"\"\n\n    @cherrypy.expose\n    @cherrypy.tools.auth_form(on=False)\n    @cherrypy.tools.sessions(on=False)\n    @cherrypy.tools.secure_headers(on=False)\n    @cherrypy.tools.staticdir(section=\"\", dir=path)\n    def handler(*args, **kwargs):\n        return None\n\n    return handler\n\n\ndef staticfile(path):\n    \"\"\"\n    Create a page handler to serve static file.\n    \"\"\"\n\n    @cherrypy.expose\n    @cherrypy.tools.auth_form(on=False)\n    @cherrypy.tools.sessions(on=False)\n    @cherrypy.tools.secure_headers(on=False)\n    @cherrypy.tools.staticfile(filename=path)\n    def handler(*args, **kwargs):\n        return None\n\n    return handler\n", "code_before": "# -*- coding: utf-8 -*-\n# rdiffweb, A web interface to rdiff-backup repositories\n# Copyright (C) 2012-2021 rdiffweb contributors\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\"\"\"\nDefault page handler\n\n@author: Patrik Dufresne <patrik@ikus-soft.com>\n\"\"\"\n\n\nimport os\n\nimport cherrypy\nfrom cherrypy.lib.static import mimetypes, serve_file\n\nfrom rdiffweb.core.rdw_helpers import unquote_url\n\n\ndef poppath(*args, **kwargs):\n    \"\"\"\n    A decorator for _cp_dispatch\n    (cherrypy.dispatch.Dispatcher.dispatch_method_name).\n\n    Used to merge the segment of URI into a single parameter denoting the\n    repository path.\n    \"\"\"\n\n    # Since keyword arg comes after *args, we have to process it ourselves\n    # for lower versions of python.\n\n    handler = None\n    handler_call = False\n    for k, v in kwargs.items():\n        if k == 'handler':\n            handler = v\n        else:\n            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))\n\n    import inspect\n\n    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):\n        handler_call = True\n\n    def decorated(cls_or_self=None, vpath=None):\n        if inspect.isclass(cls_or_self):\n            # cherrypy.poppath is a class decorator\n            cls = cls_or_self\n            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)\n            return cls\n\n        # We're in the actual function\n        self = cls_or_self\n        parms = {}\n        for arg in args:\n            if not vpath:\n                break\n            parms[arg] = unquote_url(vpath.pop(0))\n\n        # Build repo path.\n        path = []\n        while len(vpath) > 0:\n            path.append(unquote_url(vpath.pop(0)))\n        parms['path'] = b\"/\".join(path)\n\n        if handler is not None:\n            if handler_call:\n                return handler(**parms)\n            else:\n                cherrypy.request.params.update(parms)  # @UndefinedVariable\n                return handler\n\n        cherrypy.request.params.update(parms)  # @UndefinedVariable\n\n        # If we are the ultimate handler, then to prevent our _cp_dispatch\n        # from being called again, we will resolve remaining elements through\n        # getattr() directly.\n        if vpath:\n            return getattr(self, vpath.pop(0), None)\n        else:\n            return self\n\n    return decorated\n\n\ndef static(path):\n    \"\"\"\n    Create a page handler to serve static files. Disable authentication.\n    \"\"\"\n    assert isinstance(path, str)\n    assert os.path.exists(path), \"%r doesn't exists\" % path\n    content_type = None\n    if os.path.isfile(path):\n        # Set content-type based on filename extension\n        ext = \"\"\n        i = path.rfind('.')\n        if i != -1:\n            ext = path[i:].lower()\n        content_type = mimetypes.types_map.get(ext, None)  # @UndefinedVariable\n\n    @cherrypy.expose\n    @cherrypy.tools.auth_form(on=False)\n    @cherrypy.tools.sessions(on=False)\n    @cherrypy.tools.secure_headers(on=False)\n    def handler(*args, **kwargs):\n        if cherrypy.request.method not in ('GET', 'HEAD'):\n            return None\n        filename = os.path.join(path, *args)\n        assert filename.startswith(path)\n        if not os.path.isfile(filename):\n            return None\n        return serve_file(filename, content_type)\n\n    return handler\n", "patch": "@@ -22,10 +22,7 @@\n \"\"\"\n \n \n-import os\n-\n import cherrypy\n-from cherrypy.lib.static import mimetypes, serve_file\n \n from rdiffweb.core.rdw_helpers import unquote_url\n \n@@ -96,32 +93,33 @@ def decorated(cls_or_self=None, vpath=None):\n     return decorated\n \n \n-def static(path):\n+def staticdir(path):\n+    \"\"\"\n+    Create a page handler to serve static directory.\n+    \"\"\"\n+\n+    @cherrypy.expose\n+    @cherrypy.tools.auth_form(on=False)\n+    @cherrypy.tools.sessions(on=False)\n+    @cherrypy.tools.secure_headers(on=False)\n+    @cherrypy.tools.staticdir(section=\"\", dir=path)\n+    def handler(*args, **kwargs):\n+        return None\n+\n+    return handler\n+\n+\n+def staticfile(path):\n     \"\"\"\n-    Create a page handler to serve static files. Disable authentication.\n+    Create a page handler to serve static file.\n     \"\"\"\n-    assert isinstance(path, str)\n-    assert os.path.exists(path), \"%r doesn't exists\" % path\n-    content_type = None\n-    if os.path.isfile(path):\n-        # Set content-type based on filename extension\n-        ext = \"\"\n-        i = path.rfind('.')\n-        if i != -1:\n-            ext = path[i:].lower()\n-        content_type = mimetypes.types_map.get(ext, None)  # @UndefinedVariable\n \n     @cherrypy.expose\n     @cherrypy.tools.auth_form(on=False)\n     @cherrypy.tools.sessions(on=False)\n     @cherrypy.tools.secure_headers(on=False)\n+    @cherrypy.tools.staticfile(filename=path)\n     def handler(*args, **kwargs):\n-        if cherrypy.request.method not in ('GET', 'HEAD'):\n-            return None\n-        filename = os.path.join(path, *args)\n-        assert filename.startswith(path)\n-        if not os.path.isfile(filename):\n-            return None\n-        return serve_file(filename, content_type)\n+        return None\n \n     return handler", "file_path": "files/2022_10/666", "file_language": "py", "file_name": "rdiffweb/controller/dispatch.py", "outdated_file_modify": 0, "outdated_file_before": 0, "outdated_file_after": 1, "llm_check": 0, "static_check": 0, "static": {"rats": [false, []], "semgrep": [false, []]}, "target": 0, "function_before": [{"function": "def poppath(*args, **kwargs):\n    \"\"\"\n    A decorator for _cp_dispatch\n    (cherrypy.dispatch.Dispatcher.dispatch_method_name).\n\n    Used to merge the segment of URI into a single parameter denoting the\n    repository path.\n    \"\"\"\n\n    # Since keyword arg comes after *args, we have to process it ourselves\n    # for lower versions of python.\n\n    handler = None\n    handler_call = False\n    for k, v in kwargs.items():\n        if k == 'handler':\n            handler = v\n        else:\n            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))\n\n    import inspect\n\n    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):\n        handler_call = True\n\n    def decorated(cls_or_self=None, vpath=None):\n        if inspect.isclass(cls_or_self):\n            # cherrypy.poppath is a class decorator\n            cls = cls_or_self\n            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)\n            return cls\n\n        # We're in the actual function\n        self = cls_or_self\n        parms = {}\n        for arg in args:\n            if not vpath:\n                break\n            parms[arg] = unquote_url(vpath.pop(0))\n\n        # Build repo path.\n        path = []\n        while len(vpath) > 0:\n            path.append(unquote_url(vpath.pop(0)))\n        parms['path'] = b\"/\".join(path)\n\n        if handler is not None:\n            if handler_call:\n                return handler(**parms)\n            else:\n                cherrypy.request.params.update(parms)  # @UndefinedVariable\n                return handler\n\n        cherrypy.request.params.update(parms)  # @UndefinedVariable\n\n        # If we are the ultimate handler, then to prevent our _cp_dispatch\n        # from being called again, we will resolve remaining elements through\n        # getattr() directly.\n        if vpath:\n            return getattr(self, vpath.pop(0), None)\n        else:\n            return self\n\n    return decorated", "target": 0}, {"function": "def static(path):\n    \"\"\"\n    Create a page handler to serve static files. Disable authentication.\n    \"\"\"\n    assert isinstance(path, str)\n    assert os.path.exists(path), \"%r doesn't exists\" % path\n    content_type = None\n    if os.path.isfile(path):\n        # Set content-type based on filename extension\n        ext = \"\"\n        i = path.rfind('.')\n        if i != -1:\n            ext = path[i:].lower()\n        content_type = mimetypes.types_map.get(ext, None)  # @UndefinedVariable\n\n    @cherrypy.expose\n    @cherrypy.tools.auth_form(on=False)\n    @cherrypy.tools.sessions(on=False)\n    @cherrypy.tools.secure_headers(on=False)\n    def handler(*args, **kwargs):\n        if cherrypy.request.method not in ('GET', 'HEAD'):\n            return None\n        filename = os.path.join(path, *args)\n        assert filename.startswith(path)\n        if not os.path.isfile(filename):\n            return None\n        return serve_file(filename, content_type)\n\n    return handler", "target": 0}], "function_after": [{"function": "def poppath(*args, **kwargs):\n    \"\"\"\n    A decorator for _cp_dispatch\n    (cherrypy.dispatch.Dispatcher.dispatch_method_name).\n\n    Used to merge the segment of URI into a single parameter denoting the\n    repository path.\n    \"\"\"\n\n    # Since keyword arg comes after *args, we have to process it ourselves\n    # for lower versions of python.\n\n    handler = None\n    handler_call = False\n    for k, v in kwargs.items():\n        if k == 'handler':\n            handler = v\n        else:\n            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))\n\n    import inspect\n\n    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):\n        handler_call = True\n\n    def decorated(cls_or_self=None, vpath=None):\n        if inspect.isclass(cls_or_self):\n            # cherrypy.poppath is a class decorator\n            cls = cls_or_self\n            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)\n            return cls\n\n        # We're in the actual function\n        self = cls_or_self\n        parms = {}\n        for arg in args:\n            if not vpath:\n                break\n            parms[arg] = unquote_url(vpath.pop(0))\n\n        # Build repo path.\n        path = []\n        while len(vpath) > 0:\n            path.append(unquote_url(vpath.pop(0)))\n        parms['path'] = b\"/\".join(path)\n\n        if handler is not None:\n            if handler_call:\n                return handler(**parms)\n            else:\n                cherrypy.request.params.update(parms)  # @UndefinedVariable\n                return handler\n\n        cherrypy.request.params.update(parms)  # @UndefinedVariable\n\n        # If we are the ultimate handler, then to prevent our _cp_dispatch\n        # from being called again, we will resolve remaining elements through\n        # getattr() directly.\n        if vpath:\n            return getattr(self, vpath.pop(0), None)\n        else:\n            return self\n\n    return decorated", "target": 0}, {"function": "def staticdir(path):\n    \"\"\"\n    Create a page handler to serve static directory.\n    \"\"\"\n\n    @cherrypy.expose\n    @cherrypy.tools.auth_form(on=False)\n    @cherrypy.tools.sessions(on=False)\n    @cherrypy.tools.secure_headers(on=False)\n    @cherrypy.tools.staticdir(section=\"\", dir=path)\n    def handler(*args, **kwargs):\n        return None\n\n    return handler", "target": 0}, {"function": "def staticfile(path):\n    \"\"\"\n    Create a page handler to serve static file.\n    \"\"\"\n\n    @cherrypy.expose\n    @cherrypy.tools.auth_form(on=False)\n    @cherrypy.tools.sessions(on=False)\n    @cherrypy.tools.secure_headers(on=False)\n    @cherrypy.tools.staticfile(filename=path)\n    def handler(*args, **kwargs):\n        return None\n\n    return handler", "target": 0}]}, {"raw_url": "https://github.com/ikus060/rdiffweb/raw/323383d1db656f1b1291be529947bd943a6b0e99/rdiffweb%2Fcontroller%2Ftests%2Ftest_controller.py", "code": "# -*- coding: utf-8 -*-\n# rdiffweb, A web interface to rdiff-backup repositories\n# Copyright (C) 2012-2021 rdiffweb contributors\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\"\"\"\nCreated on Mar 13, 2019\n\n@author: Patrik Dufresne\n\"\"\"\n\nfrom parameterized import parameterized\n\nimport rdiffweb.test\n\n\nclass ControllerTest(rdiffweb.test.WebCase):\n\n    login = True\n\n    default_config = {'HeaderName': 'MyTest'}\n\n    def test_headername(self):\n        \"\"\"\n        Check if the headername is used in the page.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertStatus('200 OK')\n        self.assertInBody('MyTest')\n\n    def test_theme(self):\n        \"\"\"\n        Check if the theme is properly configure.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertStatus('200 OK')\n        self.assertInBody('/static/default.css')\n\n    @parameterized.expand(\n        [\n            '/favicon.ico',\n            '/static/default.css',\n            '/static/js/rdiffweb.js',\n            '/static/orange.css',\n        ]\n    )\n    def test_static_files(self, path):\n        \"\"\"\n        Check if the theme is properly configure.\n        \"\"\"\n        self.getPage('/logout')\n        self.getPage(path)\n        self.assertStatus(200)\n\n    def test_path_traversal(self):\n        self.getPage('/static//../../test.txt')\n        self.assertStatus(403)\n\n\nclass ControllerOrangeThemeTest(rdiffweb.test.WebCase):\n\n    login = True\n\n    default_config = {'DefaultTheme': 'orange'}\n\n    from parameterized import parameterized\n\n    def test_static(self):\n        \"\"\"\n        Check if the theme is properly configure.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertStatus('200 OK')\n        self.assertInBody('/static/orange.css')\n\n\nclass ControllerBlueThemeTest(rdiffweb.test.WebCase):\n\n    login = True\n\n    default_config = {'DefaultTheme': 'blue'}\n\n    def test_theme(self):\n        \"\"\"\n        Check if the theme is properly configure.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertInBody('/static/blue.css')\n", "code_before": "# -*- coding: utf-8 -*-\n# rdiffweb, A web interface to rdiff-backup repositories\n# Copyright (C) 2012-2021 rdiffweb contributors\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\"\"\"\nCreated on Mar 13, 2019\n\n@author: Patrik Dufresne\n\"\"\"\n\n\nimport rdiffweb.test\n\n\nclass ControllerTest(rdiffweb.test.WebCase):\n\n    login = True\n\n    default_config = {'HeaderName': 'MyTest'}\n\n    def test_headername(self):\n        \"\"\"\n        Check if the headername is used in the page.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertStatus('200 OK')\n        self.assertInBody('MyTest')\n\n    def test_theme(self):\n        \"\"\"\n        Check if the theme is properly configure.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertStatus('200 OK')\n        self.assertInBody('/static/default.css')\n\n\nclass ControllerOrangeThemeTest(rdiffweb.test.WebCase):\n\n    login = True\n\n    default_config = {'DefaultTheme': 'orange'}\n\n    def test_theme(self):\n        \"\"\"\n        Check if the theme is properly configure.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertStatus('200 OK')\n        self.assertInBody('/static/orange.css')\n\n\nclass ControllerBlueThemeTest(rdiffweb.test.WebCase):\n\n    login = True\n\n    default_config = {'DefaultTheme': 'blue'}\n\n    def test_theme(self):\n        \"\"\"\n        Check if the theme is properly configure.\n        \"\"\"\n        self.getPage(\"/\")\n        self.assertInBody('/static/blue.css')\n", "patch": "@@ -20,6 +20,7 @@\n @author: Patrik Dufresne\n \"\"\"\n \n+from parameterized import parameterized\n \n import rdiffweb.test\n \n@@ -46,14 +47,36 @@ def test_theme(self):\n         self.assertStatus('200 OK')\n         self.assertInBody('/static/default.css')\n \n+    @parameterized.expand(\n+        [\n+            '/favicon.ico',\n+            '/static/default.css',\n+            '/static/js/rdiffweb.js',\n+            '/static/orange.css',\n+        ]\n+    )\n+    def test_static_files(self, path):\n+        \"\"\"\n+        Check if the theme is properly configure.\n+        \"\"\"\n+        self.getPage('/logout')\n+        self.getPage(path)\n+        self.assertStatus(200)\n+\n+    def test_path_traversal(self):\n+        self.getPage('/static//../../test.txt')\n+        self.assertStatus(403)\n+\n \n class ControllerOrangeThemeTest(rdiffweb.test.WebCase):\n \n     login = True\n \n     default_config = {'DefaultTheme': 'orange'}\n \n-    def test_theme(self):\n+    from parameterized import parameterized\n+\n+    def test_static(self):\n         \"\"\"\n         Check if the theme is properly configure.\n         \"\"\"", "file_path": "files/2022_10/667", "file_language": "py", "file_name": "rdiffweb/controller/tests/test_controller.py", "outdated_file_modify": 1, "outdated_file_before": 0, "outdated_file_after": 1, "llm_check": 1, "static_check": 0, "static": {"rats": [false, []], "semgrep": [false, []]}, "target": -1, "function_before": [], "function_after": []}, {"raw_url": "https://github.com/ikus060/rdiffweb/raw/323383d1db656f1b1291be529947bd943a6b0e99/rdiffweb%2Frdw_app.py", "code": "# -*- coding: utf-8 -*-\n# rdiffweb, A web interface to rdiff-backup repositories\n# Copyright (C) 2012-2021 rdiffweb contributors\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nimport logging\nimport os\n\nimport cherrypy\nimport cherrypy.lib.sessions\nimport pkg_resources\nfrom cherrypy import Application\n\nimport rdiffweb\nimport rdiffweb.controller.filter_authorization\nimport rdiffweb.core.notification\nimport rdiffweb.core.quota\nimport rdiffweb.core.remove_older\nimport rdiffweb.plugins.ldap\nimport rdiffweb.plugins.scheduler\nimport rdiffweb.plugins.smtp\nimport rdiffweb.tools.auth_basic\nimport rdiffweb.tools.auth_form\nimport rdiffweb.tools.currentuser\nimport rdiffweb.tools.errors\nimport rdiffweb.tools.i18n\nimport rdiffweb.tools.proxy\nimport rdiffweb.tools.ratelimit\nimport rdiffweb.tools.real_ip\nimport rdiffweb.tools.secure_headers\nfrom rdiffweb.controller import Controller\nfrom rdiffweb.controller.api import ApiPage\nfrom rdiffweb.controller.dispatch import staticdir, staticfile\nfrom rdiffweb.controller.page_admin import AdminPage\nfrom rdiffweb.controller.page_browse import BrowsePage\nfrom rdiffweb.controller.page_delete import DeletePage\nfrom rdiffweb.controller.page_graphs import GraphsPage\nfrom rdiffweb.controller.page_history import HistoryPage\nfrom rdiffweb.controller.page_locations import LocationsPage\nfrom rdiffweb.controller.page_login import LoginPage, LogoutPage\nfrom rdiffweb.controller.page_logs import LogsPage\nfrom rdiffweb.controller.page_prefs import PreferencesPage\nfrom rdiffweb.controller.page_restore import RestorePage\nfrom rdiffweb.controller.page_settings import SettingsPage\nfrom rdiffweb.controller.page_status import StatusPage\nfrom rdiffweb.core import rdw_templating\nfrom rdiffweb.core.config import Option, parse_args\nfrom rdiffweb.core.store import Store\n\n# Define the logger\nlogger = logging.getLogger(__name__)\n\n# Define cherrypy development environment\ncherrypy.config.environments['development'] = {\n    'engine.autoreload.on': True,\n    'checker.on': False,\n    'tools.log_headers.on': True,\n    'request.show_tracebacks': True,\n    'request.show_mismatched_params': True,\n    'log.screen': False,\n}\n\n\n@cherrypy.tools.proxy(remote=None)\n@cherrypy.tools.secure_headers()\n@cherrypy.tools.real_ip()\nclass Root(LocationsPage):\n    def __init__(self):\n        self.login = LoginPage()\n        self.logout = LogoutPage()\n        self.browse = BrowsePage()\n        self.delete = DeletePage()\n        self.restore = RestorePage()\n        self.history = HistoryPage()\n        self.status = StatusPage()\n        self.admin = AdminPage()\n        self.prefs = PreferencesPage()\n        self.settings = SettingsPage()\n        self.api = ApiPage()\n        # Keep this for backward compatibility.\n        self.api.set_encoding = self.settings\n        self.api.remove_older = self.settings\n        self.graphs = GraphsPage()\n        self.logs = LogsPage()\n\n        # Register static dir.\n        static_dir = pkg_resources.resource_filename('rdiffweb', 'static')  # @UndefinedVariable\n        self.static = staticdir(static_dir)\n\n        # Register robots.txt\n        robots_txt = pkg_resources.resource_filename('rdiffweb', 'static/robots.txt')  # @UndefinedVariable\n        self.robots_txt = staticfile(robots_txt)\n\n\nclass RdiffwebApp(Application):\n    \"\"\"This class represent the application context.\"\"\"\n\n    _favicon = Option('favicon')\n\n    _header_logo = Option('header_logo')\n\n    _tempdir = Option('tempdir')\n\n    _session_dir = Option('session_dir')\n\n    @classmethod\n    def parse_args(cls, args=None, config_file_contents=None):\n        return parse_args(args, config_file_contents)\n\n    def __init__(self, cfg):\n        self.cfg = cfg\n        cherrypy.config.update(\n            {\n                'environment': 'development' if cfg.debug else cfg.environment,\n                # Configure LDAP plugin\n                'ldap.uri': cfg.ldap_uri,\n                'ldap.base_dn': cfg.ldap_base_dn,\n                'ldap.bind_dn': cfg.ldap_bind_dn,\n                'ldap.bind_password': cfg.ldap_bind_password,\n                'ldap.scope': cfg.ldap_scope,\n                'ldap.tls': cfg.ldap_tls,\n                'ldap.username_attribute': cfg.ldap_username_attribute,\n                'ldap.required_group': cfg.ldap_required_group,\n                'ldap.group_attribute': cfg.ldap_group_attribute,\n                'ldap.group_attribute_is_dn': cfg.ldap_group_attribute_is_dn,\n                'ldap.version': cfg.ldap_version,\n                'ldap.network_timeout': cfg.ldap_network_timeout,\n                'ldap.timeout': cfg.ldap_timeout,\n                'ldap.encoding': cfg.ldap_encoding,\n                # Configure SMTP plugin\n                'smtp.server': cfg.email_host,\n                'smtp.username': cfg.email_username,\n                'smtp.password': cfg.email_password,\n                'smtp.email_from': cfg.email_sender\n                and '%s <%s>'\n                % (\n                    cfg.header_name,\n                    cfg.email_sender,\n                ),\n                'smtp.encryption': cfg.email_encryption,\n                # Configure remove_older plugin\n                'remove_older.execution_time': self.cfg.remove_older_time,\n                # Configure notification plugin\n                'notification.execution_time': self.cfg.email_notification_time,\n                'notification.send_changed': self.cfg.email_send_changed_notification,\n                # Configure quota plugin\n                'quota.set_quota_cmd': self.cfg.quota_set_cmd,\n                'quota.get_quota_cmd': self.cfg.quota_get_cmd,\n                'quota.get_usage_cmd': self.cfg.quota_used_cmd,\n            }\n        )\n\n        # Initialise the template engine.\n        self.templates = rdw_templating.TemplateManager()\n\n        # Pick the right implementation for storage\n        session_storage_class = cherrypy.lib.sessions.RamSession\n        rate_limit_storage_class = rdiffweb.tools.ratelimit.RamRateLimit\n        if self._session_dir:\n            session_storage_class = cherrypy.lib.sessions.FileSession\n            rate_limit_storage_class = rdiffweb.tools.ratelimit.FileRateLimit\n\n        config = {\n            '/': {\n                # To work around the new behaviour in CherryPy >= 5.5.0, force usage of\n                # ISO-8859-1 encoding for URL. This avoid any conversion of the\n                # URL into UTF-8.\n                'request.uri_encoding': 'ISO-8859-1',\n                'tools.auth_basic.realm': 'rdiffweb',\n                'tools.auth_basic.checkpassword': self._checkpassword,\n                'tools.auth_form.on': True,\n                'tools.currentuser.on': True,\n                'tools.currentuser.userobj': lambda username: self.store.get_user(username),\n                'tools.i18n.on': True,\n                'tools.i18n.default': 'en_US',\n                'tools.i18n.mo_dir': pkg_resources.resource_filename('rdiffweb', 'locales'),  # @UndefinedVariable\n                'tools.i18n.domain': 'messages',\n                'tools.encode.on': True,\n                'tools.encode.encoding': 'utf-8',\n                'tools.gzip.on': True,\n                'error_page.default': self.error_page,\n                'tools.sessions.on': True,\n                'tools.sessions.debug': cfg.debug,\n                'tools.sessions.storage_class': session_storage_class,\n                'tools.sessions.storage_path': self._session_dir,\n                'tools.sessions.httponly': True,\n                'tools.ratelimit.debug': cfg.debug,\n                'tools.ratelimit.delay': 60,\n                'tools.ratelimit.anonymous_limit': cfg.rate_limit,\n                'tools.ratelimit.storage_class': rate_limit_storage_class,\n                'tools.ratelimit.storage_path': self._session_dir,\n            },\n        }\n\n        # Initialize the application\n        Application.__init__(self, root=Root(), config=config)\n\n        # Register favicon.ico\n        self.root.favicon_ico = staticfile(self._favicon)\n\n        # Register header_logo\n        if self._header_logo:\n            self.root.header_logo = staticfile(self._header_logo)\n\n        # Define TEMP env\n        if self._tempdir:\n            os.environ[\"TMPDIR\"] = self._tempdir\n\n        # create user manager\n        self.store = Store(self)\n        self.store.create_admin_user()\n\n    @property\n    def currentuser(self):\n        \"\"\"\n        Proxy property to get current user from cherrypy request object.\n        Return a UserObject when logged in or None.\n        \"\"\"\n        return getattr(cherrypy.serving.request, 'currentuser', None)\n\n    def _checkpassword(self, realm, username, password):\n        \"\"\"\n        Check basic authentication.\n        \"\"\"\n        return self.store.login(username, password) is not None\n\n    def error_page(self, **kwargs):\n        \"\"\"\n        Default error page shown to the user when an unexpected error occur.\n        \"\"\"\n        # Log exception.\n        logger.error(\n            'error page: %s %s\\n%s' % (kwargs.get('status', ''), kwargs.get('message', ''), kwargs.get('traceback', ''))\n        )\n\n        # Replace message by generic one for 404. Default implementation leak path info.\n        if kwargs.get('status', '') == '404 Not Found':\n            kwargs['message'] = 'Nothing matches the given URI'\n\n        # Check expected response type.\n        mtype = cherrypy.tools.accept.callable(['text/html', 'text/plain'])  # @UndefinedVariable\n        if mtype == 'text/plain':\n            return kwargs.get('message')\n\n        # Try to build a nice error page.\n        try:\n            page = Controller()\n            return page._compile_template('error_page_default.html', **kwargs)\n        except Exception:\n            # If failing, send the raw error message.\n            return kwargs.get('message')\n\n    @property\n    def version(self):\n        \"\"\"\n        Get the current running version (using package info).\n        \"\"\"\n        return rdiffweb.__version__\n", "code_before": "# -*- coding: utf-8 -*-\n# rdiffweb, A web interface to rdiff-backup repositories\n# Copyright (C) 2012-2021 rdiffweb contributors\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nimport logging\nimport os\n\nimport cherrypy\nimport cherrypy.lib.sessions\nimport pkg_resources\nfrom cherrypy import Application\n\nimport rdiffweb\nimport rdiffweb.controller.filter_authorization\nimport rdiffweb.core.notification\nimport rdiffweb.core.quota\nimport rdiffweb.core.remove_older\nimport rdiffweb.plugins.ldap\nimport rdiffweb.plugins.scheduler\nimport rdiffweb.plugins.smtp\nimport rdiffweb.tools.auth_basic\nimport rdiffweb.tools.auth_form\nimport rdiffweb.tools.currentuser\nimport rdiffweb.tools.errors\nimport rdiffweb.tools.i18n\nimport rdiffweb.tools.proxy\nimport rdiffweb.tools.ratelimit\nimport rdiffweb.tools.real_ip\nimport rdiffweb.tools.secure_headers\nfrom rdiffweb.controller import Controller\nfrom rdiffweb.controller.api import ApiPage\nfrom rdiffweb.controller.dispatch import static  # noqa\nfrom rdiffweb.controller.page_admin import AdminPage\nfrom rdiffweb.controller.page_browse import BrowsePage\nfrom rdiffweb.controller.page_delete import DeletePage\nfrom rdiffweb.controller.page_graphs import GraphsPage\nfrom rdiffweb.controller.page_history import HistoryPage\nfrom rdiffweb.controller.page_locations import LocationsPage\nfrom rdiffweb.controller.page_login import LoginPage, LogoutPage\nfrom rdiffweb.controller.page_logs import LogsPage\nfrom rdiffweb.controller.page_prefs import PreferencesPage\nfrom rdiffweb.controller.page_restore import RestorePage\nfrom rdiffweb.controller.page_settings import SettingsPage\nfrom rdiffweb.controller.page_status import StatusPage\nfrom rdiffweb.core import rdw_templating\nfrom rdiffweb.core.config import Option, parse_args\nfrom rdiffweb.core.store import Store\n\n# Define the logger\nlogger = logging.getLogger(__name__)\n\n# Define cherrypy development environment\ncherrypy.config.environments['development'] = {\n    'engine.autoreload.on': True,\n    'checker.on': False,\n    'tools.log_headers.on': True,\n    'request.show_tracebacks': True,\n    'request.show_mismatched_params': True,\n    'log.screen': False,\n}\n\n\n@cherrypy.tools.proxy(remote=None)\n@cherrypy.tools.secure_headers()\n@cherrypy.tools.real_ip()\nclass Root(LocationsPage):\n    def __init__(self):\n        self.login = LoginPage()\n        self.logout = LogoutPage()\n        self.browse = BrowsePage()\n        self.delete = DeletePage()\n        self.restore = RestorePage()\n        self.history = HistoryPage()\n        self.status = StatusPage()\n        self.admin = AdminPage()\n        self.prefs = PreferencesPage()\n        self.settings = SettingsPage()\n        self.api = ApiPage()\n        # Keep this for backward compatibility.\n        self.api.set_encoding = self.settings\n        self.api.remove_older = self.settings\n        self.graphs = GraphsPage()\n        self.logs = LogsPage()\n\n        # Register static dir.\n        static_dir = pkg_resources.resource_filename('rdiffweb', 'static')  # @UndefinedVariable\n        self.static = static(static_dir)\n\n        # Register robots.txt\n        robots_txt = pkg_resources.resource_filename('rdiffweb', 'static/robots.txt')  # @UndefinedVariable\n        self.robots_txt = static(robots_txt)\n\n\nclass RdiffwebApp(Application):\n    \"\"\"This class represent the application context.\"\"\"\n\n    _favicon = Option('favicon')\n\n    _header_logo = Option('header_logo')\n\n    _tempdir = Option('tempdir')\n\n    _session_dir = Option('session_dir')\n\n    @classmethod\n    def parse_args(cls, args=None, config_file_contents=None):\n        return parse_args(args, config_file_contents)\n\n    def __init__(self, cfg):\n        self.cfg = cfg\n        cherrypy.config.update(\n            {\n                'environment': 'development' if cfg.debug else cfg.environment,\n                # Configure LDAP plugin\n                'ldap.uri': cfg.ldap_uri,\n                'ldap.base_dn': cfg.ldap_base_dn,\n                'ldap.bind_dn': cfg.ldap_bind_dn,\n                'ldap.bind_password': cfg.ldap_bind_password,\n                'ldap.scope': cfg.ldap_scope,\n                'ldap.tls': cfg.ldap_tls,\n                'ldap.username_attribute': cfg.ldap_username_attribute,\n                'ldap.required_group': cfg.ldap_required_group,\n                'ldap.group_attribute': cfg.ldap_group_attribute,\n                'ldap.group_attribute_is_dn': cfg.ldap_group_attribute_is_dn,\n                'ldap.version': cfg.ldap_version,\n                'ldap.network_timeout': cfg.ldap_network_timeout,\n                'ldap.timeout': cfg.ldap_timeout,\n                'ldap.encoding': cfg.ldap_encoding,\n                # Configure SMTP plugin\n                'smtp.server': cfg.email_host,\n                'smtp.username': cfg.email_username,\n                'smtp.password': cfg.email_password,\n                'smtp.email_from': cfg.email_sender\n                and '%s <%s>'\n                % (\n                    cfg.header_name,\n                    cfg.email_sender,\n                ),\n                'smtp.encryption': cfg.email_encryption,\n                # Configure remove_older plugin\n                'remove_older.execution_time': self.cfg.remove_older_time,\n                # Configure notification plugin\n                'notification.execution_time': self.cfg.email_notification_time,\n                'notification.send_changed': self.cfg.email_send_changed_notification,\n                # Configure quota plugin\n                'quota.set_quota_cmd': self.cfg.quota_set_cmd,\n                'quota.get_quota_cmd': self.cfg.quota_get_cmd,\n                'quota.get_usage_cmd': self.cfg.quota_used_cmd,\n            }\n        )\n\n        # Initialise the template engine.\n        self.templates = rdw_templating.TemplateManager()\n\n        # Pick the right implementation for storage\n        session_storage_class = cherrypy.lib.sessions.RamSession\n        rate_limit_storage_class = rdiffweb.tools.ratelimit.RamRateLimit\n        if self._session_dir:\n            session_storage_class = cherrypy.lib.sessions.FileSession\n            rate_limit_storage_class = rdiffweb.tools.ratelimit.FileRateLimit\n\n        config = {\n            '/': {\n                # To work around the new behaviour in CherryPy >= 5.5.0, force usage of\n                # ISO-8859-1 encoding for URL. This avoid any conversion of the\n                # URL into UTF-8.\n                'request.uri_encoding': 'ISO-8859-1',\n                'tools.auth_basic.realm': 'rdiffweb',\n                'tools.auth_basic.checkpassword': self._checkpassword,\n                'tools.auth_form.on': True,\n                'tools.currentuser.on': True,\n                'tools.currentuser.userobj': lambda username: self.store.get_user(username),\n                'tools.i18n.on': True,\n                'tools.i18n.default': 'en_US',\n                'tools.i18n.mo_dir': pkg_resources.resource_filename('rdiffweb', 'locales'),  # @UndefinedVariable\n                'tools.i18n.domain': 'messages',\n                'tools.encode.on': True,\n                'tools.encode.encoding': 'utf-8',\n                'tools.gzip.on': True,\n                'error_page.default': self.error_page,\n                'tools.sessions.on': True,\n                'tools.sessions.debug': cfg.debug,\n                'tools.sessions.storage_class': session_storage_class,\n                'tools.sessions.storage_path': self._session_dir,\n                'tools.sessions.httponly': True,\n                'tools.ratelimit.debug': cfg.debug,\n                'tools.ratelimit.delay': 60,\n                'tools.ratelimit.anonymous_limit': cfg.rate_limit,\n                'tools.ratelimit.storage_class': rate_limit_storage_class,\n                'tools.ratelimit.storage_path': self._session_dir,\n            },\n        }\n\n        # Initialize the application\n        Application.__init__(self, root=Root(), config=config)\n\n        # Register favicon.ico\n        self.root.favicon_ico = static(self._favicon)\n\n        # Register header_logo\n        if self._header_logo:\n            self.root.header_logo = static(self._header_logo)\n\n        # Define TEMP env\n        if self._tempdir:\n            os.environ[\"TMPDIR\"] = self._tempdir\n\n        # create user manager\n        self.store = Store(self)\n        self.store.create_admin_user()\n\n    @property\n    def currentuser(self):\n        \"\"\"\n        Proxy property to get current user from cherrypy request object.\n        Return a UserObject when logged in or None.\n        \"\"\"\n        return getattr(cherrypy.serving.request, 'currentuser', None)\n\n    def _checkpassword(self, realm, username, password):\n        \"\"\"\n        Check basic authentication.\n        \"\"\"\n        return self.store.login(username, password) is not None\n\n    def error_page(self, **kwargs):\n        \"\"\"\n        Default error page shown to the user when an unexpected error occur.\n        \"\"\"\n        # Log exception.\n        logger.error(\n            'error page: %s %s\\n%s' % (kwargs.get('status', ''), kwargs.get('message', ''), kwargs.get('traceback', ''))\n        )\n\n        # Replace message by generic one for 404. Default implementation leak path info.\n        if kwargs.get('status', '') == '404 Not Found':\n            kwargs['message'] = 'Nothing matches the given URI'\n\n        # Check expected response type.\n        mtype = cherrypy.tools.accept.callable(['text/html', 'text/plain'])  # @UndefinedVariable\n        if mtype == 'text/plain':\n            return kwargs.get('message')\n\n        # Try to build a nice error page.\n        try:\n            page = Controller()\n            return page._compile_template('error_page_default.html', **kwargs)\n        except Exception:\n            # If failing, send the raw error message.\n            return kwargs.get('message')\n\n    @property\n    def version(self):\n        \"\"\"\n        Get the current running version (using package info).\n        \"\"\"\n        return rdiffweb.__version__\n", "patch": "@@ -42,7 +42,7 @@\n import rdiffweb.tools.secure_headers\n from rdiffweb.controller import Controller\n from rdiffweb.controller.api import ApiPage\n-from rdiffweb.controller.dispatch import static  # noqa\n+from rdiffweb.controller.dispatch import staticdir, staticfile\n from rdiffweb.controller.page_admin import AdminPage\n from rdiffweb.controller.page_browse import BrowsePage\n from rdiffweb.controller.page_delete import DeletePage\n@@ -97,11 +97,11 @@ def __init__(self):\n \n         # Register static dir.\n         static_dir = pkg_resources.resource_filename('rdiffweb', 'static')  # @UndefinedVariable\n-        self.static = static(static_dir)\n+        self.static = staticdir(static_dir)\n \n         # Register robots.txt\n         robots_txt = pkg_resources.resource_filename('rdiffweb', 'static/robots.txt')  # @UndefinedVariable\n-        self.robots_txt = static(robots_txt)\n+        self.robots_txt = staticfile(robots_txt)\n \n \n class RdiffwebApp(Application):\n@@ -208,11 +208,11 @@ def __init__(self, cfg):\n         Application.__init__(self, root=Root(), config=config)\n \n         # Register favicon.ico\n-        self.root.favicon_ico = static(self._favicon)\n+        self.root.favicon_ico = staticfile(self._favicon)\n \n         # Register header_logo\n         if self._header_logo:\n-            self.root.header_logo = static(self._header_logo)\n+            self.root.header_logo = staticfile(self._header_logo)\n \n         # Define TEMP env\n         if self._tempdir:", "file_path": "files/2022_10/668", "file_language": "py", "file_name": "rdiffweb/rdw_app.py", "outdated_file_modify": 1, "outdated_file_before": 0, "outdated_file_after": 1, "llm_check": 1, "static_check": 0, "static": {"rats": [false, []], "semgrep": [false, []]}, "target": -1, "function_before": [], "function_after": []}], "outdated": 1, "cwe_descripiton": "", "cwe_consequence": "", "cwe_method": "", "cwe_solution": ""}
