{"index": 10829, "cve_id": "CVE-2023-27489", "cwe_id": ["CWE-79"], "cve_language": "Python", "cve_description": "Kiwi TCMS is an open source test management system for both manual and automated testing. Kiwi TCMS accepts SVG files uploaded by users which could potentially contain JavaScript code. If SVG images are viewed directly, i.e. not rendered in an HTML page, this JavaScript code could execute. This vulnerability has been fixed by configuring Kiwi TCMS to serve with the Content-Security-Policy HTTP header which blocks inline JavaScript in all modern browsers. This configuration change is provided in version 12.1 and users are advised to upgrade. Users unable to upgrade may set their Content-Security-Policy HTTP header manually.", "cvss": "5.4", "publish_date": "March 29, 2023", "AV": "NETWORK", "AC": "NETWORK", "PR": "LOW", "UI": "REQUIRED", "S": "CHANGED", "C": "LOW", "I": "LOW", "A": "NONE", "commit_id": "6617cee0fb70cc394b7be6bbc86ef84e6e9de077", "commit_message": "Define Content-Security-Policy header to block inline JavaScript\n\nalso define the same headers in middleware during testing and\ndevelopment to avoid building a container for every change", "commit_date": "2023-03-08T12:25:52Z", "project": "kiwitcms/kiwi", "url": "https://api.github.com/repos/kiwitcms/Kiwi/commits/6617cee0fb70cc394b7be6bbc86ef84e6e9de077", "html_url": "https://github.com/kiwitcms/Kiwi/commit/6617cee0fb70cc394b7be6bbc86ef84e6e9de077", "windows_before": [{"commit_id": "ba358cb3fdd07888507d800506ca6a76ded23743", "commit_date": "Thu Mar 2 23:01:08 2023 +0200", "commit_message": "Add the X-Content-Type-Options: nosniff header", "files_name": ["etc/nginx.conf", "tests/test_http.sh"]}, {"commit_id": "e995c78a0081a3c73d60f832de169a49ed4acf65", "commit_date": "Wed Mar 8 11:25:55 2023 +0200", "commit_message": "New translations django.po (Slovenian)", "files_name": ["tcms/locale/sl_SI/LC_MESSAGES/django.po"]}, {"commit_id": "3559d41c4f5f6294029967a26850b75bdcee4099", "commit_date": "Tue Mar 7 22:23:08 2023 +0200", "commit_message": "New translations django.po (Bulgarian)", "files_name": ["tcms/locale/bg_BG/LC_MESSAGES/django.po", "tcms/locale/bn_BD/LC_MESSAGES/django.po", "tcms/locale/ca_ES/LC_MESSAGES/django.po", "tcms/locale/cs_CZ/LC_MESSAGES/django.po", "tcms/locale/de_DE/LC_MESSAGES/django.po", "tcms/locale/el_GR/LC_MESSAGES/django.po", "tcms/locale/eo_UY/LC_MESSAGES/django.po", "tcms/locale/es_ES/LC_MESSAGES/django.po", "tcms/locale/fr_FR/LC_MESSAGES/django.po", "tcms/locale/he_IL/LC_MESSAGES/django.po", "tcms/locale/hi_IN/LC_MESSAGES/django.po", "tcms/locale/hu_HU/LC_MESSAGES/django.po", "tcms/locale/id_ID/LC_MESSAGES/django.po", "tcms/locale/it_IT/LC_MESSAGES/django.po", "tcms/locale/ja_JP/LC_MESSAGES/django.po", "tcms/locale/ko_KR/LC_MESSAGES/django.po", "tcms/locale/mk_MK/LC_MESSAGES/django.po", "tcms/locale/mr_IN/LC_MESSAGES/django.po", "tcms/locale/pl_PL/LC_MESSAGES/django.po", "tcms/locale/pt_BR/LC_MESSAGES/django.po", "tcms/locale/ro_RO/LC_MESSAGES/django.po", "tcms/locale/ru_RU/LC_MESSAGES/django.po", "tcms/locale/sk_SK/LC_MESSAGES/django.po", "tcms/locale/sl_SI/LC_MESSAGES/django.po", "tcms/locale/sq_AL/LC_MESSAGES/django.po", "tcms/locale/sw_KE/LC_MESSAGES/django.po", "tcms/locale/ta_IN/LC_MESSAGES/django.po", "tcms/locale/te_IN/LC_MESSAGES/django.po", "tcms/locale/tr_TR/LC_MESSAGES/django.po", "tcms/locale/vi_VN/LC_MESSAGES/django.po", "tcms/locale/zh_CN/LC_MESSAGES/django.po", "tcms/locale/zh_TW/LC_MESSAGES/django.po"]}, {"commit_id": "1fc0bd1a55ed46201084b81a340965c3bb35cce3", "commit_date": "Mon Mar 6 21:44:08 2023 +0200", "commit_message": "Enable translation integration on Admin pages too", "files_name": ["tcms/templates/admin/base_site.html"]}, {"commit_id": "97d93061a71a0f38f8c532b9c0e3006c54a7c24a", "commit_date": "Mon Mar 6 21:37:40 2023 +0200", "commit_message": "Remove inline <script> for Crowdin integration", "files_name": ["tcms/static/js/crowdin.js", "tcms/templates/base.html"]}, {"commit_id": "5f0c8177dfea6df50111cbefc80583e002e203da", "commit_date": "Mon Mar 6 21:19:43 2023 +0200", "commit_message": "Refactor how SimpleMDE editor is initialized in pages", "files_name": ["tcms/core/widgets.py", "tcms/static/js/index.js", "tcms/templates/base.html", "tcms/testcases/admin.py"]}, {"commit_id": "5cac896a9951929e41b70f29b0d73f24e1bb7e08", "commit_date": "Fri Mar 3 15:37:41 2023 +0200", "commit_message": "Move inline <script> into stand-alone file", "files_name": ["tcms/bugs/static/bugs/js/search.js", "tcms/bugs/templates/bugs/search.html", "tcms/core/templates/widgets/duration.html", "tcms/static/js/admin_override.js", "tcms/static/js/datetime_picker.js", "tcms/static/js/index.js", "tcms/telemetry/static/telemetry/js/index.js", "tcms/telemetry/templates/telemetry/include/filters.html", "tcms/templates/admin/base_site.html", "tcms/templates/base.html", "tcms/templates/include/datetimepicker_script.html", "tcms/templates/initdb.html", "tcms/testcases/static/testcases/js/mutable.js", "tcms/testcases/static/testcases/js/search.js", "tcms/testcases/templates/testcases/search.html", "tcms/testplans/static/testplans/js/search.js", "tcms/testplans/templates/testplans/search.html", "tcms/testruns/static/testruns/js/mutable.js", "tcms/testruns/static/testruns/js/search.js", "tcms/testruns/templates/testruns/mutable.html", "tcms/testruns/templates/testruns/search.html"]}, {"commit_id": "3aa044d8ef4f6f86135047b86d08ef6aa48f028d", "commit_date": "Fri Mar 3 15:33:26 2023 +0200", "commit_message": "Use the standard jQuery $ var instead of grp", "files_name": ["tcms/templates/admin/base_site.html"]}, {"commit_id": "7eb25b0cfa78909701018d22a880c93a81e0b78d", "commit_date": "Fri Mar 3 16:44:53 2023 +0200", "commit_message": "Remove unnecessary onChanged function for DurationWidget", "files_name": ["tcms/core/templates/widgets/duration.html"]}, {"commit_id": "a27e08ad80103015235a64e5f64e768b09e7a3e5", "commit_date": "Mon Feb 27 04:09:08 2023 +0000", "commit_message": "Bump eslint from 8.34.0 to 8.35.0 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "6ad16f43546eead6498dbe73cb79524057145551", "commit_date": "Tue Feb 28 11:39:20 2023 +0300", "commit_message": "Add Environment.create() RPC method. Closes #3034", "files_name": ["tcms/rpc/api/environment.py", "tcms/rpc/api/forms/testrun.py", "tcms/rpc/tests/test_environment.py"]}, {"commit_id": "42c684a12769a7d6f3a860fbe3099eae5b37bdef", "commit_date": "Thu Feb 23 14:35:41 2023 +0200", "commit_message": "Fix formatting & linters", "files_name": ["tcms/rpc/api/environment.py", "tcms/rpc/tests/test_environment.py"]}, {"commit_id": "92356ac09000f230784e3c53bc035948e5f64be0", "commit_date": "Thu Feb 23 14:41:51 2023 +0300", "commit_message": "Add Environment.filter() API method. Refs #3034", "files_name": ["tcms/rpc/api/environment.py", "tcms/rpc/tests/test_environment.py"]}, {"commit_id": "fce13654ce901258e2ecc410825da767cbf0341a", "commit_date": "Sun Feb 19 14:20:06 2023 +0200", "commit_message": "Update pygithub from 1.57 to 1.58.0", "files_name": ["requirements/base.txt"]}, {"commit_id": "aeb40deece3f600975ea0dfa0dbcee375f60af98", "commit_date": "Tue Feb 21 22:54:11 2023 +0200", "commit_message": "Add X-Frame-Options header to deny loading Kiwi TCMS into an iframe", "files_name": ["etc/nginx.conf", "tests/test_http.sh"]}, {"commit_id": "ffb2e177d6fb767f6b59cca2ffbb17fcf9a38a35", "commit_date": "Tue Feb 21 18:47:20 2023 +0200", "commit_message": "Update translation strings", "files_name": ["tcms/locale/en/LC_MESSAGES/django.po"]}, {"commit_id": "6ebd92d6e7f27ade51ed595dd89444875c72fff0", "commit_date": "Tue Feb 21 18:43:02 2023 +0200", "commit_message": "Fix typo & make sure test uses translated string", "files_name": ["tcms/kiwi_auth/admin.py", "tcms/kiwi_auth/tests/test_admin.py"]}, {"commit_id": "7a7c55c13886ecf7b2fcc7f0e1e5200574d5e274", "commit_date": "Tue Feb 21 18:38:42 2023 +0200", "commit_message": "Prohibit deletion of the last superuser", "files_name": ["tcms/core/tests/test_admin.py", "tcms/kiwi_auth/admin.py", "tcms/kiwi_auth/tests/test_admin.py"]}, {"commit_id": "a83f1570f64d30ce35471a7dd357d81df6e0fd87", "commit_date": "Fri Feb 17 20:30:04 2023 +0200", "commit_message": "Replace self.run with self.test_run in automated test", "files_name": ["tcms/rpc/tests/test_testrun.py"]}, {"commit_id": "5049dbfb846dbfa9cc682bdf41c5a7e217573e6c", "commit_date": "Fri Feb 17 19:21:12 2023 +0200", "commit_message": "Make isort happy", "files_name": ["tcms/rpc/api/testrun.py"]}, {"commit_id": "0873556c93d197acfa6e0935ada3a7464903339d", "commit_date": "Fri Feb 17 19:00:15 2023 +0200", "commit_message": "Reformat with black", "files_name": ["tcms/rpc/api/testrun.py", "tcms/rpc/tests/test_testrun.py"]}, {"commit_id": "7707f447b7ac3136d81290763ab509948aa7b603", "commit_date": "Fri Feb 17 19:01:23 2023 +0200", "commit_message": "Add missing import", "files_name": ["tcms/rpc/tests/test_testrun.py"]}, {"commit_id": "a1f01b5111f9b616135fe036c407fb10480f0605", "commit_date": "Fri Feb 17 18:59:37 2023 +0200", "commit_message": "Add missing closing bracket", "files_name": ["tcms/rpc/tests/test_testrun.py"]}, {"commit_id": "9344e2873a48da477ac565362689e4851c34214e", "commit_date": "Thu Jun 16 21:45:33 2022 -0600", "commit_message": "Add TestRun.add_attachment rpc.", "files_name": ["tcms/rpc/api/testrun.py", "tcms/rpc/tests/test_testrun.py"]}, {"commit_id": "70d67903e82e51945cacb5cf998e44a18cefc41c", "commit_date": "Thu Feb 16 22:33:10 2023 +0200", "commit_message": "Refactor bugtracker integration - don't post comments in a thread", "files_name": ["docs/source/modules/tcms.issuetracker.github_integration.rst", "docs/source/modules/tcms.issuetracker.gitlab_integration.rst", "docs/source/modules/tcms.issuetracker.jira_integration.rst", "docs/source/modules/tcms.issuetracker.redmine_integration.rst", "docs/source/modules/tcms.issuetracker.rst", "tcms/issuetracker/azure_boards.py", "tcms/issuetracker/base.py", "tcms/issuetracker/bitbucket.py", "tcms/issuetracker/bugzilla_integration.py", "tcms/issuetracker/github_integration.py", "tcms/issuetracker/gitlab_integration.py", "tcms/issuetracker/jira_integration.py", "tcms/issuetracker/kiwitcms.py", "tcms/issuetracker/redmine_integration.py", "tcms/issuetracker/tests/test_github.py", "tcms/issuetracker/tests/test_gitlab_com.py", "tcms/issuetracker/tests/test_gitlab_ee.py", "tcms/issuetracker/types.py"]}, {"commit_id": "37a74093e786a7eb156dc6cf46ebd86e448dc9b6", "commit_date": "Wed Feb 15 11:40:14 2023 +0200", "commit_message": "Changelog for v12.0", "files_name": ["CHANGELOG.rst", "tcms/__init__.py"]}, {"commit_id": "b4ad5331c7d304ff17b9f61e08f4b9765157c689", "commit_date": "Tue Feb 14 12:52:49 2023 +0200", "commit_message": "Update django from 4.1.6 to 4.1.7", "files_name": ["requirements/base.txt"]}, {"commit_id": "0fed8dae20a195353f9995e470d100e8d2527f90", "commit_date": "Mon Feb 13 04:06:49 2023 +0000", "commit_message": "Bump eslint from 8.33.0 to 8.34.0 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "463d674685ba8ee392300fc22d8047c628b37200", "commit_date": "Mon Feb 13 11:40:40 2023 +0200", "commit_message": "New translations django.po (Chinese Simplified)", "files_name": ["tcms/locale/zh_CN/LC_MESSAGES/django.po"]}, {"commit_id": "660db44f3fe01ca31e0a532549474eb35ec6f8ea", "commit_date": "Fri Feb 10 20:40:10 2023 +0200", "commit_message": "Don't show all builds on Search Test Runs page", "files_name": ["tcms/testruns/views.py"]}, {"commit_id": "761305d04f5910ba14cc04d1255a8f1afdbb87f3", "commit_date": "Thu Feb 9 16:35:52 2023 +0200", "commit_message": "Show captcha on password reset form if enabled", "files_name": ["tcms/kiwi_auth/forms.py", "tcms/kiwi_auth/tests/test_views.py", "tcms/templates/registration/password_reset_form.html"]}, {"commit_id": "0ed213fa0ddb7a6dc77e3c3b99e8fc90ccdaf46f", "commit_date": "Tue Feb 7 21:04:28 2023 +0200", "commit_message": "Rate limit everything under /accounts/", "files_name": ["etc/nginx.conf"]}, {"commit_id": "2e357ad9b06b38b145c96a6d660ef9172cf64f19", "commit_date": "Tue Feb 7 20:56:13 2023 +0200", "commit_message": "Set headers for proxied connections", "files_name": ["etc/nginx.conf"]}, {"commit_id": "7da9d14fca4ff27bbb485383bef8ba4e2c2e3abc", "commit_date": "Tue Feb 7 21:06:35 2023 +0200", "commit_message": "Add performance baseline tests for couple more pages", "files_name": ["tests/test_http.sh"]}, {"commit_id": "c36c47113786c5c23d636298e219606b64a82b98", "commit_date": "Thu Feb 2 15:21:55 2023 +0200", "commit_message": "New translations django.po (German)", "files_name": ["tcms/locale/de_DE/LC_MESSAGES/django.po"]}, {"commit_id": "651ea2cf00c8b606e3493e1578fc2203a02e4708", "commit_date": "Thu Jan 26 16:02:51 2023 +0200", "commit_message": "Update performance baseline results for Kiwi TCMS 12.0 (Nginx)", "files_name": []}], "windows_after": [{"commit_id": "ba358cb3fdd07888507d800506ca6a76ded23743", "commit_date": "Thu Mar 2 23:01:08 2023 +0200", "commit_message": "Add the X-Content-Type-Options: nosniff header", "files_name": ["etc/nginx.conf", "tests/test_http.sh"]}, {"commit_id": "ef0408c496c6b4c26fccb2eaca08aa563678a939", "commit_date": "Thu Mar 9 04:00:31 2023 +0000", "commit_message": "Bump webpack from 5.75.0 to 5.76.0 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "95717f8198b37788a242192671212d97e452f582", "commit_date": "Sat Mar 11 19:11:40 2023 +0200", "commit_message": "New translations django.po (French)", "files_name": ["tcms/locale/fr_FR/LC_MESSAGES/django.po"]}, {"commit_id": "ce90ece682fffb70ca8ca2511c709c736070d9cc", "commit_date": "Mon Mar 13 22:28:59 2023 +0200", "commit_message": "Add RobotFramework as a devel dependency", "files_name": [".github/workflows/testing.yml", "requirements/devel.txt"]}, {"commit_id": "36103abcb1d92167a17e6c6f39d135e172913e16", "commit_date": "Mon Mar 13 22:51:18 2023 +0200", "commit_message": "Add a test for inline JavaScript", "files_name": ["tests/test_http.sh", "tests/test_utf8_uploads.py", "tests/ui/data/inline_javascript.svg", "tests/ui/test_inline_javascript.robot"]}, {"commit_id": "0ed76007328c323606fbed0783a39ed8dd5a5299", "commit_date": "Mon Mar 13 04:03:15 2023 +0000", "commit_message": "Bump webpack from 5.76.0 to 5.76.1 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "31f016deb59e7ee299e0c5ead0a83d68a60abb90", "commit_date": "Mon Mar 13 04:02:44 2023 +0000", "commit_message": "Bump eslint from 8.35.0 to 8.36.0 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "16ed019392d1e6abbae41990d1d77254815d3e6c", "commit_date": "Sun Mar 12 00:15:31 2023 +0200", "commit_message": "Update jira from 3.4.1 to 3.5.0", "files_name": ["requirements/base.txt"]}, {"commit_id": "1c73a5b17b0d70d115feecc4908a696cfa3cd854", "commit_date": "Tue Mar 14 23:13:48 2023 +0200", "commit_message": "Fix a test failing b/c of French locale", "files_name": ["tcms/kiwi_auth/tests/test_admin.py"]}, {"commit_id": "290c5cc5b7a3d0b765a0d16e55d568553be12300", "commit_date": "Fri Mar 10 22:21:36 2023 +0200", "commit_message": "Update django-simple-history from 3.2.0 to 3.3.0", "files_name": ["requirements/base.txt"]}, {"commit_id": "1759c61a5956b707c0a6f05f11ee5ef408622a0a", "commit_date": "Sat Mar 18 10:25:22 2023 +0200", "commit_message": "Update pygithub from 1.58.0 to 1.58.1", "files_name": ["requirements/base.txt"]}, {"commit_id": "3e3ce679eab4facefed05196d3c903c1134d53b2", "commit_date": "Tue Mar 21 20:59:11 2023 +0200", "commit_message": "Remove the __all__ attribute in RPC modules", "files_name": ["tcms/rpc/api/attachment.py", "tcms/rpc/api/auth.py", "tcms/rpc/api/bug.py", "tcms/rpc/api/build.py", "tcms/rpc/api/component.py", "tcms/rpc/api/environment.py", "tcms/rpc/api/kiwitcms.py", "tcms/rpc/api/markdown.py", "tcms/rpc/api/plantype.py", "tcms/rpc/api/product.py", "tcms/rpc/api/testcase.py", "tcms/rpc/api/testexecution.py", "tcms/rpc/api/testplan.py", "tcms/rpc/api/testrun.py", "tcms/rpc/api/user.py", "tcms/rpc/api/version.py"]}, {"commit_id": "4eff10efaafa1d372f5830eee17b87b676d5564b", "commit_date": "Thu Mar 23 04:00:30 2023 +0000", "commit_message": "Bump webpack from 5.76.1 to 5.76.3 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "7f73d0cf21820ed03f4bd95a4d195585335d1c27", "commit_date": "Mon Mar 20 18:21:05 2023 +0200", "commit_message": "Update django-grappelli from 3.0.4 to 3.0.5", "files_name": ["requirements/base.txt"]}, {"commit_id": "3e1822874b77fd5f9296c84886135cd1a5764a76", "commit_date": "Fri Mar 24 18:35:20 2023 +0200", "commit_message": "Update tzdata from 2022.7 to 2023.2", "files_name": ["requirements/base.txt"]}, {"commit_id": "617eb581f7773a38b8b225a9a026ea51e404ab80", "commit_date": "Mon Mar 27 16:24:56 2023 +0300", "commit_message": "Add a + button for test case templates on new TestCase page", "files_name": ["tcms/testcases/static/testcases/js/mutable.js", "tcms/testcases/templates/testcases/mutable.html"]}, {"commit_id": "97cf917b4f4e8042bc9d53fc0a2809a739c1aff1", "commit_date": "Mon Mar 27 16:26:21 2023 +0300", "commit_message": "Reorder widgets on screen", "files_name": ["tcms/testcases/templates/testcases/mutable.html"]}, {"commit_id": "ede34c4a4292ca394f2694deb4d3b6468ad13ca3", "commit_date": "Mon Mar 27 20:50:14 2023 +0300", "commit_message": "Move uWSGI configuration into a file", "files_name": ["Dockerfile", "etc/uwsgi.conf", "httpd-foreground"]}, {"commit_id": "adbb1ca5dcf22408d6700f0cadcf664ff0a47bcd", "commit_date": "Mon Mar 27 20:53:22 2023 +0300", "commit_message": "Include the file /Kiwi/etc/uwsgi.override if it exists", "files_name": ["etc/uwsgi.conf"]}, {"commit_id": "4602af9e3cb7a4ccfcc5ec990ee8294a35642586", "commit_date": "Wed Mar 29 05:37:21 2023 +0300", "commit_message": "Update tzdata from 2023.2 to 2023.3", "files_name": ["requirements/base.txt"]}, {"commit_id": "b5fd25df4504dfe3f2da9fdb43dcbbb30c6d60eb", "commit_date": "Wed Mar 29 04:00:05 2023 +0000", "commit_message": "Bump eslint-plugin-n from 15.6.1 to 15.7.0 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "711bcda144d18340c6efb7e823405e9c5fbfd9b2", "commit_date": "Wed Mar 29 03:59:48 2023 +0000", "commit_message": "Bump eslint from 8.36.0 to 8.37.0 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "3326af31d6015258e79b204258e1b54763801422", "commit_date": "Thu Mar 23 17:12:31 2023 +0200", "commit_message": "Update markdown from 3.4.1 to 3.4.3", "files_name": ["requirements/base.txt"]}, {"commit_id": "63b65511a3832ac38d504489fb03a1acfb3573aa", "commit_date": "Tue Mar 28 22:23:37 2023 +0300", "commit_message": "Remove trailing <p> tags from test values", "files_name": ["tcms/core/tests/test_markdown.py"]}, {"commit_id": "363fe69d5d76bfa85f29f9468d1c9e06d3a50121", "commit_date": "Wed Feb 22 11:38:37 2023 +0300", "commit_message": "[Testruns] Replace `.append()` call with `.html()`", "files_name": ["tcms/testruns/static/testruns/js/get.js"]}, {"commit_id": "6d57e6b25e88f1ebadd11cf26ad3199eb481327d", "commit_date": "Wed Feb 22 14:24:57 2023 +0300", "commit_message": "[Testruns] Replace `.append()` on tags/components", "files_name": ["tcms/testruns/static/testruns/js/get.js"]}, {"commit_id": "e46d68358c8e97448be74e2e7054b7e4f04f4d1e", "commit_date": "Wed Mar 29 15:46:51 2023 +0300", "commit_message": "Apply fixes from eslint", "files_name": ["tcms/testruns/static/testruns/js/get.js"]}, {"commit_id": "8033b4f33d5e283c9e014800ae15c275d7734fe1", "commit_date": "Wed Mar 29 16:26:27 2023 +0300", "commit_message": "Update documentation to describe transitions for TestRun statuses", "files_name": ["docs/source/_static/Set_To_Finished.png", "docs/source/_static/Set_To_Running.png", "docs/source/guide/testrun.rst"]}, {"commit_id": "aa9e915cd064f64cdc5a1c740d8ce887e0071083", "commit_date": "Wed Mar 29 19:12:59 2023 +0300", "commit_message": "Enable testing with RobotFramework for aarch64", "files_name": [".circleci/config.yml"]}, {"commit_id": "9e1ecfe52616802804918e3857a454f992e58c88", "commit_date": "Wed Mar 29 19:20:20 2023 +0300", "commit_message": "Update Ubuntu images on Circle CI", "files_name": [".circleci/config.yml"]}, {"commit_id": "163f9ffa5771bec3063a59edb73ba32d44be97a0", "commit_date": "Wed Mar 29 18:35:09 2023 +0300", "commit_message": "Changelog for v12.1", "files_name": ["CHANGELOG.rst", "tcms/__init__.py"]}, {"commit_id": "50c645351154d57f37a0245c8f90c170cddaac79", "commit_date": "Wed Mar 29 19:49:06 2023 +0300", "commit_message": "Skip RobotFramework tests on aarch64", "files_name": ["tests/test_http.sh"]}, {"commit_id": "6f0b2a22d717cc5d9db1a7d6f278e7772994fd89", "commit_date": "Thu Mar 30 15:05:42 2023 +0300", "commit_message": "Fix include syntax for uwsgi.override", "files_name": ["etc/uwsgi.conf"]}, {"commit_id": "ca48f83f1518f553cc2af1174dd74f73fd085edc", "commit_date": "Thu Mar 30 03:59:48 2023 +0000", "commit_message": "Bump webpack from 5.76.3 to 5.77.0 in /tcms", "files_name": ["tcms/package-lock.json", "tcms/package.json"]}, {"commit_id": "d4ea64d237b06332d4730fbb3ef1b2cb68d58250", "commit_date": "Fri Mar 31 22:57:51 2023 +0300", "commit_message": "Update field label to be more readable", "files_name": ["tcms/testruns/templates/testruns/get.html"]}, {"commit_id": "c60d3bf01b383686df2df86597d4f49708249221", "commit_date": "Sat Apr 1 23:34:35 2023 +0300", "commit_message": "Allow manually resetting TestRun.stop_date via editing. Refs #3124", "files_name": ["tcms/testruns/templates/testruns/mutable.html"]}, {"commit_id": "275f2645239842d8f6f354ad1150ed64e364a748", "commit_date": "Fri Mar 31 22:26:08 2023 +0300", "commit_message": "API: TestExecution.update() will not update stop_date for status changes", "files_name": ["tcms/rpc/api/testexecution.py", "tcms/rpc/tests/test_testexecution.py"]}, {"commit_id": "157f2f114804af9d9ce4c0415c6d9ae072c27224", "commit_date": "Fri Mar 31 22:55:58 2023 +0300", "commit_message": "When changing TestExecution.status on TestRun page update stop_date", "files_name": ["tcms/testruns/static/testruns/js/get.js"]}, {"commit_id": "941f6e2b091866cabb7c7e61b0ce176d5e86a62c", "commit_date": "Fri Mar 31 23:49:27 2023 +0300", "commit_message": "Automatically update TestRun timestamps when test executions change", "files_name": ["tcms/testruns/static/testruns/js/get.js"]}, {"commit_id": "4036ee5e205b2b10ded9bfeecf8f9bc12d79c0b1", "commit_date": "Tue Apr 4 16:47:03 2023 +0300", "commit_message": "TestPlan.filter() API method will return the `children_count` field", "files_name": ["tcms/rpc/api/testplan.py", "tcms/rpc/tests/test_testplan.py"]}, {"commit_id": "8b11a7bdfd345332b18b1afedfe86855b9294a5d", "commit_date": "Tue Apr 4 17:39:09 2023 +0300", "commit_message": "Remove unused parameter from updateTestPlanSelectFromProduct()", "files_name": ["tcms/static/js/utils.js", "tcms/testruns/static/testruns/js/mutable.js"]}, {"commit_id": "16fc4650b77d6fc02f71806ff92d08c8c5768610", "commit_date": "Tue Apr 4 17:56:38 2023 +0300", "commit_message": "Additional query parameters for updateTestPlanSelectFromProduct()", "files_name": ["tcms/static/js/utils.js"]}, {"commit_id": "8b3e7784b52eef21b84ba6478922fd0fe54bf2bc", "commit_date": "Tue Apr 4 18:08:27 2023 +0300", "commit_message": "Add preProcessData callback to updateTestPlanSelectFromProduct()", "files_name": ["tcms/static/js/utils.js"]}, {"commit_id": "37156a8168bade0f406e5383b6cbf0fcae458956", "commit_date": "Tue Apr 4 19:34:04 2023 +0300", "commit_message": "Display nested test plans in drop down on Search Test Cases page", "files_name": ["tcms/testcases/static/testcases/js/search.js"]}, {"commit_id": "408b6036b7f976839fa227c8fd6b90f1ebd417c6", "commit_date": "Tue Apr 4 22:24:01 2023 +0300", "commit_message": "On Search Test Cases page display results from child test plans", "files_name": ["tcms/testcases/static/testcases/js/search.js", "tcms/testcases/templates/testcases/search.html"]}, {"commit_id": "fd4fb0a6349b3c2089a3e6e354047ff9e6bd8792", "commit_date": "Tue Apr 4 22:46:13 2023 +0300", "commit_message": "Reorder filter widgets on screen", "files_name": ["tcms/testcases/templates/testcases/search.html"]}, {"commit_id": "476202fec375ed3586cf886ee7c2775d07af125b", "commit_date": "Tue Apr 4 22:48:02 2023 +0300", "commit_message": "Shorten label string to avoid line breaks", "files_name": ["tcms/telemetry/templates/telemetry/testing/status-matrix.html", "tcms/testcases/templates/testcases/search.html"]}, {"commit_id": "71723b23b9a1a2b0b3505885d15191ed137a9a8f", "commit_date": "Tue Apr 4 22:49:18 2023 +0300", "commit_message": "Update l10n strings", "files_name": ["tcms/locale/en/LC_MESSAGES/django.po"]}, {"commit_id": "7d3091832ce2ae79a7e13950ca4d8cac1b18ddfd", "commit_date": "Tue Apr 4 22:56:29 2023 +0300", "commit_message": "Fix test case filter widget on Test Plan page. Fixes #3137", "files_name": ["tcms/testplans/static/testplans/js/get.js"]}, {"commit_id": "16f60acb395ca5486bcae796c14367e86189a0e5", "commit_date": "Wed Apr 5 00:08:19 2023 +0300", "commit_message": "Update translation strings", "files_name": ["tcms/locale/bg_BG/LC_MESSAGES/django.po", "tcms/locale/bn_BD/LC_MESSAGES/django.po", "tcms/locale/ca_ES/LC_MESSAGES/django.po", "tcms/locale/cs_CZ/LC_MESSAGES/django.po", "tcms/locale/de_DE/LC_MESSAGES/django.po", "tcms/locale/el_GR/LC_MESSAGES/django.po", "tcms/locale/eo_UY/LC_MESSAGES/django.po", "tcms/locale/es_ES/LC_MESSAGES/django.po"]}], "parents": [{"commit_id_before": "ba358cb3fdd07888507d800506ca6a76ded23743", "url_before": "https://api.github.com/repos/kiwitcms/Kiwi/commits/ba358cb3fdd07888507d800506ca6a76ded23743", "html_url_before": "https://github.com/kiwitcms/Kiwi/commit/ba358cb3fdd07888507d800506ca6a76ded23743"}], "details": [{"raw_url": "https://github.com/kiwitcms/Kiwi/raw/6617cee0fb70cc394b7be6bbc86ef84e6e9de077/etc%2Fnginx.conf", "code": "# For more information on configuration, see:\n#   * Official English Documentation: http://nginx.org/en/docs/\n\ndaemon on;\nworker_processes auto;\nerror_log /dev/stderr;\npid /tmp/nginx.pid;\n\n# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.\ninclude /usr/share/nginx/modules/*.conf;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /dev/stdout  main;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 4096;\n\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n\n    gzip on;\n    gzip_disable \"msie6\";\n\n    # note: this should be bigger than\n    # FILE_UPLOAD_MAX_SIZE from Kiwi TCMS which defaults to 5M.\n    client_max_body_size 10m;\n\n    # limit URI size, see\n    # https://github.com/kiwitcms/Kiwi/issues/1054\n    large_client_header_buffers 4 10k;\n\n    ssl_certificate     /Kiwi/ssl/localhost.crt;\n    ssl_certificate_key /Kiwi/ssl/localhost.key;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers off;\n\n    # default proxy settings\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n\n    map $request_uri $limit_key {\n        default \"\";\n        ~^/accounts/ $binary_remote_addr;\n    }\n    limit_req_zone $limit_key zone=ten-per-sec:10m rate=10r/s;\n    limit_req_status 429;\n\n    upstream kiwitcms {\n        server unix:///tmp/kiwitcms.sock;\n    }\n\n    # WARNING: make sure these match tcms.core.middleware.ExtraHeadersMiddleware\n    add_header X-Frame-Options DENY;\n    add_header X-Content-Type-Options nosniff;\n    add_header Content-Security-Policy \"script-src 'self' cdn.crowdin.com;\";\n\n    server {\n        listen       8080;\n        listen       [::]:8080;\n        server_name  _;\n\n        location / {\n                return 301 https://$host$request_uri;\n        }\n    }\n\n    server {\n        listen       8443 ssl;\n        listen       [::]:8443 ssl;\n        server_name  _;\n\n        location /uploads/  {\n            alias /Kiwi/uploads/;\n        }\n\n        location /static/ {\n            alias /Kiwi/static/;\n        }\n\n        location / {\n            include     /etc/nginx/uwsgi_params;\n            uwsgi_pass  kiwitcms;\n\n            limit_req zone=ten-per-sec burst=20 nodelay;\n        }\n    }\n}\n", "code_before": "# For more information on configuration, see:\n#   * Official English Documentation: http://nginx.org/en/docs/\n\ndaemon on;\nworker_processes auto;\nerror_log /dev/stderr;\npid /tmp/nginx.pid;\n\n# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.\ninclude /usr/share/nginx/modules/*.conf;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /dev/stdout  main;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 4096;\n\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n\n    gzip on;\n    gzip_disable \"msie6\";\n\n    # note: this should be bigger than\n    # FILE_UPLOAD_MAX_SIZE from Kiwi TCMS which defaults to 5M.\n    client_max_body_size 10m;\n\n    # limit URI size, see\n    # https://github.com/kiwitcms/Kiwi/issues/1054\n    large_client_header_buffers 4 10k;\n\n    ssl_certificate     /Kiwi/ssl/localhost.crt;\n    ssl_certificate_key /Kiwi/ssl/localhost.key;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers off;\n\n    # default proxy settings\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n\n    map $request_uri $limit_key {\n        default \"\";\n        ~^/accounts/ $binary_remote_addr;\n    }\n    limit_req_zone $limit_key zone=ten-per-sec:10m rate=10r/s;\n    limit_req_status 429;\n\n    upstream kiwitcms {\n        server unix:///tmp/kiwitcms.sock;\n    }\n\n    add_header X-Frame-Options DENY;\n    add_header X-Content-Type-Options nosniff;\n\n    server {\n        listen       8080;\n        listen       [::]:8080;\n        server_name  _;\n\n        location / {\n                return 301 https://$host$request_uri;\n        }\n    }\n\n    server {\n        listen       8443 ssl;\n        listen       [::]:8443 ssl;\n        server_name  _;\n\n        location /uploads/  {\n            alias /Kiwi/uploads/;\n        }\n\n        location /static/ {\n            alias /Kiwi/static/;\n        }\n\n        location / {\n            include     /etc/nginx/uwsgi_params;\n            uwsgi_pass  kiwitcms;\n\n            limit_req zone=ten-per-sec burst=20 nodelay;\n        }\n    }\n}\n", "patch": "@@ -62,8 +62,10 @@ http {\n         server unix:///tmp/kiwitcms.sock;\n     }\n \n+    # WARNING: make sure these match tcms.core.middleware.ExtraHeadersMiddleware\n     add_header X-Frame-Options DENY;\n     add_header X-Content-Type-Options nosniff;\n+    add_header Content-Security-Policy \"script-src 'self' cdn.crowdin.com;\";\n \n     server {\n         listen       8080;", "file_path": "files/2023_3/85", "file_language": "conf", "file_name": "etc/nginx.conf", "outdated_file_modify": 0, "outdated_file_before": 1, "outdated_file_after": 1}, {"raw_url": "https://github.com/kiwitcms/Kiwi/raw/6617cee0fb70cc394b7be6bbc86ef84e6e9de077/tcms%2Fcore%2Fmiddleware.py", "code": "# pylint: disable=no-self-use, too-few-public-methods\n\nfrom django.conf import settings\nfrom django.contrib.sites.models import Site\nfrom django.db.utils import OperationalError, ProgrammingError\nfrom django.http import HttpResponseRedirect\nfrom django.urls import reverse\nfrom django.utils.deprecation import MiddlewareMixin\n\n\nclass CheckDBStructureExistsMiddleware(MiddlewareMixin):\n    def process_request(self, request):\n        if request.path == \"/init-db/\":\n            return None\n        try:\n            Site.objects.get(pk=settings.SITE_ID)\n        except (OperationalError, ProgrammingError):\n            # Redirect to Setup view\n            return HttpResponseRedirect(reverse(\"init-db\"))\n        return None\n\n\nclass ExtraHeadersMiddleware(MiddlewareMixin):\n    \"\"\"\n    This is enabled only during testing and development. The actual headers\n    are configured in `etc/nginx.conf`!\n    \"\"\"\n\n    def process_response(self, request, response):\n        if settings.DEBUG:\n            response.headers[\"X-Frame-Options\"] = \"DENY\"\n            response.headers[\"X-Content-Type-Options\"] = \"nosniff\"\n            response.headers[\n                \"Content-Security-Policy\"\n            ] = \"script-src 'self' cdn.crowdin.com;\"\n\n        return response\n", "code_before": "# pylint: disable=no-self-use, too-few-public-methods\n\nfrom django.conf import settings\nfrom django.contrib.sites.models import Site\nfrom django.db.utils import OperationalError, ProgrammingError\nfrom django.http import HttpResponseRedirect\nfrom django.urls import reverse\nfrom django.utils.deprecation import MiddlewareMixin\n\n\nclass CheckDBStructureExistsMiddleware(MiddlewareMixin):\n    def process_request(self, request):\n        if request.path == \"/init-db/\":\n            return None\n        try:\n            Site.objects.get(pk=settings.SITE_ID)\n        except (OperationalError, ProgrammingError):\n            # Redirect to Setup view\n            return HttpResponseRedirect(reverse(\"init-db\"))\n        return None\n", "patch": "@@ -18,3 +18,20 @@ def process_request(self, request):\n             # Redirect to Setup view\n             return HttpResponseRedirect(reverse(\"init-db\"))\n         return None\n+\n+\n+class ExtraHeadersMiddleware(MiddlewareMixin):\n+    \"\"\"\n+    This is enabled only during testing and development. The actual headers\n+    are configured in `etc/nginx.conf`!\n+    \"\"\"\n+\n+    def process_response(self, request, response):\n+        if settings.DEBUG:\n+            response.headers[\"X-Frame-Options\"] = \"DENY\"\n+            response.headers[\"X-Content-Type-Options\"] = \"nosniff\"\n+            response.headers[\n+                \"Content-Security-Policy\"\n+            ] = \"script-src 'self' cdn.crowdin.com;\"\n+\n+        return response", "file_path": "files/2023_3/86", "file_language": "py", "file_name": "tcms/core/middleware.py", "outdated_file_modify": 0, "outdated_file_before": 0, "outdated_file_after": 0, "llm_check": 0, "static_check": 0, "static": {"rats": [false, []], "semgrep": [false, []]}, "target": 0, "function_before": [{"function": "class CheckDBStructureExistsMiddleware(MiddlewareMixin):\n    def process_request(self, request):\n        if request.path == \"/init-db/\":\n            return None\n        try:\n            Site.objects.get(pk=settings.SITE_ID)\n        except (OperationalError, ProgrammingError):\n            # Redirect to Setup view\n            return HttpResponseRedirect(reverse(\"init-db\"))\n        return None", "target": 0}], "function_after": [{"function": "class CheckDBStructureExistsMiddleware(MiddlewareMixin):\n    def process_request(self, request):\n        if request.path == \"/init-db/\":\n            return None\n        try:\n            Site.objects.get(pk=settings.SITE_ID)\n        except (OperationalError, ProgrammingError):\n            # Redirect to Setup view\n            return HttpResponseRedirect(reverse(\"init-db\"))\n        return None", "target": 0}, {"function": "class ExtraHeadersMiddleware(MiddlewareMixin):\n    \"\"\"\n    This is enabled only during testing and development. The actual headers\n    are configured in `etc/nginx.conf`!\n    \"\"\"\n\n    def process_response(self, request, response):\n        if settings.DEBUG:\n            response.headers[\"X-Frame-Options\"] = \"DENY\"\n            response.headers[\"X-Content-Type-Options\"] = \"nosniff\"\n            response.headers[\n                \"Content-Security-Policy\"\n            ] = \"script-src 'self' cdn.crowdin.com;\"\n\n        return response", "target": 0}]}, {"raw_url": "https://github.com/kiwitcms/Kiwi/raw/6617cee0fb70cc394b7be6bbc86ef84e6e9de077/tcms%2Fsettings%2Fdevel.py", "code": "# pylint: disable=wildcard-import, unused-wildcard-import\n\"\"\"\n    Django settings for devel env.\n\"\"\"\n\nimport os\n\nfrom .common import *  # noqa: F403\n\n# Debug settings\nDEBUG = True\n\n# Database settings\nDATABASES = {\n    \"default\": {\n        \"ENGINE\": \"django.db.backends.sqlite3\",\n        \"NAME\": str(TEMP_DIR / \"kiwi.devel.sqlite\"),  # noqa: F405\n        \"USER\": \"root\",\n        \"PASSWORD\": \"\",\n        \"HOST\": \"\",\n        \"PORT\": \"\",\n    }\n}\n\n\nCACHES = {\n    \"default\": {\n        \"BACKEND\": \"django.core.cache.backends.dummy.DummyCache\",\n    }\n}\n# django-debug-toolbar settings\n\nMIDDLEWARE += [  # noqa: F405\n    \"debug_toolbar.middleware.DebugToolbarMiddleware\",\n    \"tcms.core.middleware.ExtraHeadersMiddleware\",\n]\n\nINSTALLED_APPS += [\"debug_toolbar\"]  # noqa: F405\n\nMEDIA_ROOT = os.path.join(TCMS_ROOT_PATH, \"..\", \"uploads\")  # noqa: F405\n\n# Needed by django.template.context_processors.debug:\n# See:\n# http://docs.djangoproject.com/en/dev/ref/templates/api/#django-template-context-processors-debug\nINTERNAL_IPS = (\"127.0.0.1\",)\n\nSTATICFILES_STORAGE = \"tcms.tests.storage.RaiseWhenFileNotFound\"\n", "code_before": "# pylint: disable=wildcard-import, unused-wildcard-import\n\"\"\"\n    Django settings for devel env.\n\"\"\"\n\nimport os\n\nfrom .common import *  # noqa: F403\n\n# Debug settings\nDEBUG = True\n\n# Database settings\nDATABASES = {\n    \"default\": {\n        \"ENGINE\": \"django.db.backends.sqlite3\",\n        \"NAME\": str(TEMP_DIR / \"kiwi.devel.sqlite\"),  # noqa: F405\n        \"USER\": \"root\",\n        \"PASSWORD\": \"\",\n        \"HOST\": \"\",\n        \"PORT\": \"\",\n    }\n}\n\n\nCACHES = {\n    \"default\": {\n        \"BACKEND\": \"django.core.cache.backends.dummy.DummyCache\",\n    }\n}\n# django-debug-toolbar settings\n\nMIDDLEWARE += [\"debug_toolbar.middleware.DebugToolbarMiddleware\"]  # noqa: F405\n\nINSTALLED_APPS += [\"debug_toolbar\"]  # noqa: F405\n\nMEDIA_ROOT = os.path.join(TCMS_ROOT_PATH, \"..\", \"uploads\")  # noqa: F405\n\n# Needed by django.template.context_processors.debug:\n# See:\n# http://docs.djangoproject.com/en/dev/ref/templates/api/#django-template-context-processors-debug\nINTERNAL_IPS = (\"127.0.0.1\",)\n\nSTATICFILES_STORAGE = \"tcms.tests.storage.RaiseWhenFileNotFound\"\n", "patch": "@@ -30,7 +30,10 @@\n }\n # django-debug-toolbar settings\n \n-MIDDLEWARE += [\"debug_toolbar.middleware.DebugToolbarMiddleware\"]  # noqa: F405\n+MIDDLEWARE += [  # noqa: F405\n+    \"debug_toolbar.middleware.DebugToolbarMiddleware\",\n+    \"tcms.core.middleware.ExtraHeadersMiddleware\",\n+]\n \n INSTALLED_APPS += [\"debug_toolbar\"]  # noqa: F405\n ", "file_path": "files/2023_3/87", "file_language": "py", "file_name": "tcms/settings/devel.py", "outdated_file_modify": 0, "outdated_file_before": 0, "outdated_file_after": 0, "llm_check": 0, "static_check": 0, "static": {"rats": [false, []], "semgrep": [false, []]}, "target": 0, "function_before": [], "function_after": []}, {"raw_url": "https://github.com/kiwitcms/Kiwi/raw/6617cee0fb70cc394b7be6bbc86ef84e6e9de077/tests%2Ftest_http.sh", "code": "#!/bin/bash\n\n. /usr/share/beakerlib/beakerlib.sh\n\nassert_up_and_running() {\n    sleep 10\n    # HTTP redirects; HTTPS display the login page\n    rlRun -t -c \"curl       -o- http://localhost/  | grep '301 Moved Permanently'\"\n    rlRun -t -c \"curl -k -L -o- https://localhost/ | grep 'Welcome to Kiwi TCMS'\"\n}\n\nget_dashboard() {\n    rlRun -t -c \"curl -k -L -o- -c /tmp/testcookies.txt $1/\"\n    CSRF_TOKEN=$(grep csrftoken /tmp/testcookies.txt | cut -f 7)\n    rlRun -t -c \"curl -e $1/accounts/login/ -d username=testadmin -d password=password \\\n        -d csrfmiddlewaretoken=$CSRF_TOKEN -k -L -i -o /tmp/testdata.txt \\\n        -b /tmp/testcookies.txt -c /tmp/login-cookies.txt $1/accounts/login/\"\n    rlAssertGrep \"<title>Kiwi TCMS - Dashboard</title>\" /tmp/testdata.txt\n}\n\nexec_wrk() {\n    URL=$1\n    LOGS_DIR=$2\n    LOG_BASENAME=$3\n    EXTRA_HEADERS=${4:-\"X-Dummy-Header: 1\"}\n\n    WRK_FILE=\"$LOGS_DIR/$LOG_BASENAME.log\"\n\n    wrk -d10s -t4 -c4 -H \"$EXTRA_HEADERS\" \"$URL\" > \"$WRK_FILE\"\n\n    TOTAL_REQUESTS=$(grep 'requests in ' \"$WRK_FILE\" | tr -s ' ' | cut -f2 -d' ')\n    FAILED_REQUESTS=$(grep 'Non-2xx or 3xx responses:' \"$WRK_FILE\" | tr -d ' ' | cut -f2 -d:)\n    test -z \"$FAILED_REQUESTS\" && FAILED_REQUESTS=\"0\"\n    COMPLETED_REQUESTS=$((TOTAL_REQUESTS - FAILED_REQUESTS))\n\n    return \"$COMPLETED_REQUESTS\"\n}\n\nrlJournalStart\n    rlPhaseStartSetup\n        # wait for tear-down from previous script b/c\n        # in CI subsequent tests can't find the db host\n        sleep 5\n\n        WRK_DIR=$(mktemp -d ./wrk-logs-XXXX)\n        chmod go+rwx \"$WRK_DIR\"\n\n        rlRun -t -c \"docker-compose up -d\"\n        sleep 10\n        rlRun -t -c \"docker exec -i kiwi_web /Kiwi/manage.py migrate\"\n        assert_up_and_running\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should not display SSL warning for HTTPS connection\"\n        rlRun -t -c \"docker exec -i kiwi_web /Kiwi/manage.py createsuperuser \\\n            --username testadmin --email testadmin@domain.com --noinput\"\n        rlRun -t -c \"cat tests/set_testadmin_pass.py | docker exec -i kiwi_web /Kiwi/manage.py shell\"\n\n        get_dashboard \"https://localhost\"\n        rlAssertNotGrep \"You are not using a secure connection.\" /tmp/testdata.txt\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should allow file upload with UTF-8 filenames\"\n        cat > ~/.tcms.conf << _EOF_\n[tcms]\nurl = https://localhost/xml-rpc/\nusername = testadmin\npassword = password\n_EOF_\n\n        rlRun -t -c \"./tests/test_utf8_uploads.py -v\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should send ETag header\"\n        rlRun -t -c \"curl -k -D- https://localhost/static/images/kiwi_h20.png 2>/dev/null | grep 'ETag'\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should NOT send Cache-Control header\"\n        rlRun -t -c \"curl -k -D- https://localhost/static/images/kiwi_h20.png 2>/dev/null | grep 'Cache-Control'\" 1\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should send X-Frame-Options header\"\n        rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep 'X-Frame-Options: DENY'\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should send X-Content-Type-Options header\"\n        rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep 'X-Content-Type-Options: nosniff'\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should send Content-Security-Policy header\"\n        rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep $'Content-Security-Policy: script-src \\'self\\' cdn.crowdin.com;'\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for /accounts/register/\"\n        exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"register-account-page\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for /accounts/login/\"\n        exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"login-page\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for /accounts/passwordreset/\"\n        exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"password-reset-page\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for static file\"\n        exec_wrk \"https://localhost/static/images/kiwi_h20.png\" \"$WRK_DIR\" \"static-image\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for / aka dashboard\"\n        # Note: the cookies file is created in get_dashboard() above\n        SESSION_ID=$(grep sessionid /tmp/login-cookies.txt | cut -f 7)\n        exec_wrk \"https://localhost/\" \"$WRK_DIR\" \"dashboard\" \"Cookie: sessionid=$SESSION_ID\"\n    rlPhaseEnd\n\n    rlPhaseStartCleanup\n        rlRun -t -c \"docker-compose down\"\n        rm -f /tmp/testcookies.txt\n        rm -f /tmp/testdata.txt\n        if [ -n \"$ImageOS\" ]; then\n            rlRun -t -c \"docker volume rm kiwi_db_data\"\n        fi\n    rlPhaseEnd\nrlJournalEnd\n\nrlJournalPrintText\n", "code_before": "#!/bin/bash\n\n. /usr/share/beakerlib/beakerlib.sh\n\nassert_up_and_running() {\n    sleep 10\n    # HTTP redirects; HTTPS display the login page\n    rlRun -t -c \"curl       -o- http://localhost/  | grep '301 Moved Permanently'\"\n    rlRun -t -c \"curl -k -L -o- https://localhost/ | grep 'Welcome to Kiwi TCMS'\"\n}\n\nget_dashboard() {\n    rlRun -t -c \"curl -k -L -o- -c /tmp/testcookies.txt $1/\"\n    CSRF_TOKEN=$(grep csrftoken /tmp/testcookies.txt | cut -f 7)\n    rlRun -t -c \"curl -e $1/accounts/login/ -d username=testadmin -d password=password \\\n        -d csrfmiddlewaretoken=$CSRF_TOKEN -k -L -i -o /tmp/testdata.txt \\\n        -b /tmp/testcookies.txt -c /tmp/login-cookies.txt $1/accounts/login/\"\n    rlAssertGrep \"<title>Kiwi TCMS - Dashboard</title>\" /tmp/testdata.txt\n}\n\nexec_wrk() {\n    URL=$1\n    LOGS_DIR=$2\n    LOG_BASENAME=$3\n    EXTRA_HEADERS=${4:-\"X-Dummy-Header: 1\"}\n\n    WRK_FILE=\"$LOGS_DIR/$LOG_BASENAME.log\"\n\n    wrk -d10s -t4 -c4 -H \"$EXTRA_HEADERS\" \"$URL\" > \"$WRK_FILE\"\n\n    TOTAL_REQUESTS=$(grep 'requests in ' \"$WRK_FILE\" | tr -s ' ' | cut -f2 -d' ')\n    FAILED_REQUESTS=$(grep 'Non-2xx or 3xx responses:' \"$WRK_FILE\" | tr -d ' ' | cut -f2 -d:)\n    test -z \"$FAILED_REQUESTS\" && FAILED_REQUESTS=\"0\"\n    COMPLETED_REQUESTS=$((TOTAL_REQUESTS - FAILED_REQUESTS))\n\n    return \"$COMPLETED_REQUESTS\"\n}\n\nrlJournalStart\n    rlPhaseStartSetup\n        # wait for tear-down from previous script b/c\n        # in CI subsequent tests can't find the db host\n        sleep 5\n\n        WRK_DIR=$(mktemp -d ./wrk-logs-XXXX)\n        chmod go+rwx \"$WRK_DIR\"\n\n        rlRun -t -c \"docker-compose up -d\"\n        sleep 10\n        rlRun -t -c \"docker exec -i kiwi_web /Kiwi/manage.py migrate\"\n        assert_up_and_running\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should not display SSL warning for HTTPS connection\"\n        rlRun -t -c \"docker exec -i kiwi_web /Kiwi/manage.py createsuperuser \\\n            --username testadmin --email testadmin@domain.com --noinput\"\n        rlRun -t -c \"cat tests/set_testadmin_pass.py | docker exec -i kiwi_web /Kiwi/manage.py shell\"\n\n        get_dashboard \"https://localhost\"\n        rlAssertNotGrep \"You are not using a secure connection.\" /tmp/testdata.txt\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should allow file upload with UTF-8 filenames\"\n        cat > ~/.tcms.conf << _EOF_\n[tcms]\nurl = https://localhost/xml-rpc/\nusername = testadmin\npassword = password\n_EOF_\n\n        rlRun -t -c \"./tests/test_utf8_uploads.py -v\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should send ETag header\"\n        rlRun -t -c \"curl -k -D- https://localhost/static/images/kiwi_h20.png 2>/dev/null | grep 'ETag'\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should NOT send Cache-Control header\"\n        rlRun -t -c \"curl -k -D- https://localhost/static/images/kiwi_h20.png 2>/dev/null | grep 'Cache-Control'\" 1\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should send X-Frame-Options header\"\n        rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep 'X-Frame-Options: DENY'\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Should send X-Content-Type-Options header\"\n        rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep 'X-Content-Type-Options: nosniff'\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for /accounts/register/\"\n        exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"register-account-page\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for /accounts/login/\"\n        exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"login-page\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for /accounts/passwordreset/\"\n        exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"password-reset-page\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for static file\"\n        exec_wrk \"https://localhost/static/images/kiwi_h20.png\" \"$WRK_DIR\" \"static-image\"\n    rlPhaseEnd\n\n    rlPhaseStartTest \"Performance baseline for / aka dashboard\"\n        # Note: the cookies file is created in get_dashboard() above\n        SESSION_ID=$(grep sessionid /tmp/login-cookies.txt | cut -f 7)\n        exec_wrk \"https://localhost/\" \"$WRK_DIR\" \"dashboard\" \"Cookie: sessionid=$SESSION_ID\"\n    rlPhaseEnd\n\n    rlPhaseStartCleanup\n        rlRun -t -c \"docker-compose down\"\n        rm -f /tmp/testcookies.txt\n        rm -f /tmp/testdata.txt\n        if [ -n \"$ImageOS\" ]; then\n            rlRun -t -c \"docker volume rm kiwi_db_data\"\n        fi\n    rlPhaseEnd\nrlJournalEnd\n\nrlJournalPrintText\n", "patch": "@@ -87,6 +87,10 @@ _EOF_\n         rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep 'X-Content-Type-Options: nosniff'\"\n     rlPhaseEnd\n \n+    rlPhaseStartTest \"Should send Content-Security-Policy header\"\n+        rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep $'Content-Security-Policy: script-src \\'self\\' cdn.crowdin.com;'\"\n+    rlPhaseEnd\n+\n     rlPhaseStartTest \"Performance baseline for /accounts/register/\"\n         exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"register-account-page\"\n     rlPhaseEnd", "file_path": "files/2023_3/88", "file_language": "sh", "file_name": "tests/test_http.sh", "outdated_file_modify": 0, "outdated_file_before": 1, "outdated_file_after": 1}], "outdated": 0, "cwe_descripiton": "", "cwe_consequence": "", "cwe_method": "", "cwe_solution": ""}
